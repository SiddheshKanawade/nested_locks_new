/* Generated by CIL v. 1.7.3 */
/* print_CIL_Input is true */

#line 3 "sumo/sumoR.c"
typedef unsigned char U8;
#line 4 "sumo/sumoR.c"
typedef unsigned long U32;
#line 45 "sumo/sumoR.c"
typedef unsigned char U8___0;
#line 46 "sumo/sumoR.c"
typedef unsigned short U16___0;
#line 47 "sumo/sumoR.c"
typedef unsigned long U32___0;
#line 53 "sumo/sumoR.c"
struct i2c_partial_transaction {
   U8___0 start : 1 ;
   U8___0 restart : 1 ;
   U8___0 stop : 1 ;
   U8___0 tx : 1 ;
   U8___0 last_pt : 1 ;
   U16___0 nbytes ;
   U8___0 *data ;
};
#line 62
enum __anonenum_i2c_port_state_506411302 {
    I2C_UNINITIALISED = 0,
    I2C_IDLE = 1,
    I2C_BEGIN = 2,
    I2C_RESTART1 = 3,
    I2C_START1 = 4,
    I2C_START2 = 5,
    I2C_START3 = 6,
    I2C_START_RECLOCK1 = 7,
    I2C_LOW0 = 8,
    I2C_LOW1 = 9,
    I2C_HIGH0 = 10,
    I2C_HIGH1 = 11,
    I2C_STOP0 = 12,
    I2C_STOP1 = 13,
    I2C_STOP2 = 14,
    I2C_STOP3 = 15
} ;
#line 80 "sumo/sumoR.c"
typedef enum __anonenum_i2c_port_state_506411302 i2c_port_state;
#line 81 "sumo/sumoR.c"
struct i2c_port_struct {
   U32___0 scl_pin ;
   U32___0 sda_pin ;
   U8___0 addr_int[2] ;
   U8___0 addr ;
   struct i2c_partial_transaction partial_transaction[3] ;
   struct i2c_partial_transaction *current_pt ;
   i2c_port_state state ;
   U32___0 nbits ;
   U32___0 ack_slot ;
   U32___0 ack_slot_pending ;
   U8___0 *dataN ;
   U32___0 transmitting ;
   U32___0 fault ;
   U32___0 n_fault ;
   U32___0 n_good ;
   U32___0 ack_fail ;
   U32___0 ack_good ;
   U32___0 pt_num ;
   U32___0 pt_begun ;
};
#line 102 "sumo/sumoR.c"
typedef unsigned char U8___1;
#line 104 "sumo/sumoR.c"
typedef unsigned short U16___1;
#line 105 "sumo/sumoR.c"
typedef short S16___0;
#line 106 "sumo/sumoR.c"
typedef unsigned long U32___1;
#line 107 "sumo/sumoR.c"
typedef long S32___0;
#line 258 "sumo/sumoR.c"
struct __anonstruct_NXTCOLORSENSOR_T_371327434 {
   U16___1 color ;
   S16___0 rgb[3] ;
   U16___1 light ;
   U8___1 volatile   mode ;
   U8___1 volatile   mode_state ;
   U8___1 volatile   port_in_use ;
};
#line 266 "sumo/sumoR.c"
typedef struct __anonstruct_NXTCOLORSENSOR_T_371327434 NXTCOLORSENSOR_T;
#line 267 "sumo/sumoR.c"
typedef unsigned char U8___2;
#line 268 "sumo/sumoR.c"
typedef signed char S8___1;
#line 270 "sumo/sumoR.c"
typedef unsigned long U32___2;
#line 272 "sumo/sumoR.c"
struct __anonstruct_to_avr_432250394 {
   U8___2 power ;
   U8___2 pwm_frequency ;
   S8___1 output_percent[4] ;
   U8___2 output_mode ;
   U8___2 input_power ;
} __attribute__((__packed__)) ;
#line 279 "sumo/sumoR.c"
typedef struct __anonstruct_to_avr_432250394 to_avr;
#line 294 "sumo/sumoR.c"
typedef unsigned long U32___3;
#line 296 "sumo/sumoR.c"
struct motor_struct {
   int current_count ;
   int target_count ;
   int speed_percent ;
   U32___3 last ;
};
#line 302 "sumo/sumoR.c"
typedef unsigned char UINT8;
#line 303 "sumo/sumoR.c"
typedef UINT8 StatusType;
#line 304 "sumo/sumoR.c"
typedef UINT8 ResourceType;
#line 305 "sumo/sumoR.c"
typedef unsigned char U8___3;
#line 306 "sumo/sumoR.c"
typedef unsigned short U16___3;
#line 307 "sumo/sumoR.c"
typedef unsigned long U32___4;
#line 308 "sumo/sumoR.c"
typedef long S32___1;
#line 309 "sumo/sumoR.c"
struct dc_t {
   U32___4 duration ;
   S32___1 speed_left ;
   S32___1 speed_right ;
   int priority ;
};
#line 316
extern void display_update(void) ;
#line 318
extern void display_clear(U32 updateToo ) ;
#line 320
extern void display_char(int c ) ;
#line 329 "sumo/sumoR.c"
int display_tick  ;
#line 330 "sumo/sumoR.c"
int display_auto_update  ;
#line 336
extern unsigned long systick_get_ms(void) ;
#line 347 "sumo/sumoR.c"
U8 const   *displayM  =    (U8 const   *)((U8 *)0);
#line 348 "sumo/sumoR.c"
unsigned char volatile   dirty  =    (U8 volatile   )0;
#line 349 "sumo/sumoR.c"
unsigned char volatile   page  =    (U8 volatile   )0;
#line 350 "sumo/sumoR.c"
U8 const volatile   *dataM  =    (U8 const volatile   *)((U8 *)0);
#line 351 "sumo/sumoR.c"
U8 mode  =    (U8 )255;
#line 1075 "sumo/sumoR.c"
int display_x  ;
#line 1076 "sumo/sumoR.c"
int display_y  ;
#line 1447
extern int i2c_busy(int port ) ;
#line 1454 "sumo/sumoR.c"
static struct i2c_port_struct i2c_port[4]  ;
#line 2243 "sumo/sumoR.c"
static S32___0 distance_state[4]  = {      (S32___0 )-1,      (S32___0 )-1,      (S32___0 )-1,      (S32___0 )-1};
#line 2283 "sumo/sumoR.c"
U8___1 const   NXT_COLORSENSOR_PROTOCOLS[7]  = {      (U8___1 const   )176,      (U8___1 const   )112,      (U8___1 const   )240,      (U8___1 const   )8, 
        (U8___1 const   )176,      (U8___1 const   )136,      (U8___1 const   )136};
#line 2286 "sumo/sumoR.c"
static NXTCOLORSENSOR_T sensor_data[4]  ;
#line 3843 "sumo/sumoR.c"
static to_avr io_to_avr  ;
#line 4107 "sumo/sumoR.c"
static struct motor_struct motor[3]  ;
#line 4249
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) rand)(void) ;
#line 4250
extern StatusType TerminateTask(void) ;
#line 4251
extern StatusType GetResource(ResourceType resid ) ;
#line 4252
extern StatusType ReleaseResource(ResourceType resid ) ;
#line 4253
extern ResourceType DrivingControlResource ;
#line 4254 "sumo/sumoR.c"
struct dc_t dc  =    {(U32___4 )0, (S32___1 )0, (S32___1 )0, 5};
#line 4255 "sumo/sumoR.c"
U32___4 SeekStarted  ;
#line 4256 "sumo/sumoR.c"
S32___1 LastSonarValue  ;
#line 4257 "sumo/sumoR.c"
int InSetupPhase  ;
#line 4258 "sumo/sumoR.c"
U32___4 SetupStarted  ;
#line 4259 "sumo/sumoR.c"
void TaskMainMotorcontrolTask(void) 
{ 
  U32___3 n1 ;
  int speed_percent2 ;
  int brake3 ;
  U32___3 n4 ;
  int speed_percent5 ;
  int brake6 ;
  U32___2 n7 ;
  int power_percent8 ;
  int brake9 ;
  U32___2 n10 ;
  int power_percent11 ;
  int brake12 ;

  {
#line 4275
  if (InSetupPhase) {
#line 4276
    TerminateTask();
  }
#line 4278
  GetResource(DrivingControlResource);
#line 4279
  if (dc.duration > 0UL) {
#line 4280
    dc.duration -= 50UL;
  } else {
#line 4282
    dc.priority = 5;
#line 4283
    dc.duration = (U32___4 )0;
#line 4284
    dc.speed_left = (S32___1 )0;
#line 4285
    dc.speed_right = (S32___1 )0;
  }
#line 4287
  n1 = (U32___4 )1;
#line 4288
  speed_percent2 = (int )(- dc.speed_left);
#line 4289
  brake3 = 1;
#line 4290
  if (n1 < 3UL) {
#line 4291
    if (speed_percent2 > 100) {
#line 4292
      speed_percent2 = 100;
    }
#line 4294
    if (speed_percent2 < -100) {
#line 4295
      speed_percent2 = -100;
    }
#line 4297
    motor[n1].speed_percent = speed_percent2;
#line 4298
    n7 = n1;
#line 4299
    power_percent8 = speed_percent2;
#line 4300
    brake9 = brake3;
#line 4301
    if (n7 < 3UL) {
#line 4302
      io_to_avr.output_percent[n7] = (S8___1 )power_percent8;
#line 4303
      if (brake9) {
#line 4304
        io_to_avr.output_mode = (U8___2 )((int )io_to_avr.output_mode | (1 << n7));
      } else {
#line 4306
        io_to_avr.output_mode = (U8___2 )((int )io_to_avr.output_mode & ~ (1 << n7));
      }
    }
#line 4309
    goto Lret_nxt_avr_set_motor;
    Lret_nxt_avr_set_motor: ;
  }
#line 4312
  goto Lret_nxt_motor_set_speed;
  Lret_nxt_motor_set_speed: 
#line 4314
  n4 = (U32___4 )0;
#line 4315
  speed_percent5 = (int )(- dc.speed_right);
#line 4316
  brake6 = 1;
#line 4317
  if (n4 < 3UL) {
#line 4318
    if (speed_percent5 > 100) {
#line 4319
      speed_percent5 = 100;
    }
#line 4321
    if (speed_percent5 < -100) {
#line 4322
      speed_percent5 = -100;
    }
#line 4324
    motor[n4].speed_percent = speed_percent5;
#line 4325
    n10 = n4;
#line 4326
    power_percent11 = speed_percent5;
#line 4327
    brake12 = brake6;
#line 4328
    if (n10 < 3UL) {
#line 4329
      io_to_avr.output_percent[n10] = (S8___1 )power_percent11;
#line 4330
      if (brake12) {
#line 4331
        io_to_avr.output_mode = (U8___2 )((int )io_to_avr.output_mode | (1 << n10));
      } else {
#line 4333
        io_to_avr.output_mode = (U8___2 )((int )io_to_avr.output_mode & ~ (1 << n10));
      }
    }
#line 4336
    goto Lret_nxt_avr_set_motor___0;
    Lret_nxt_avr_set_motor___0: ;
  }
#line 4339
  goto Lret_nxt_motor_set_speed___0;
  Lret_nxt_motor_set_speed___0: 
#line 4341
  ReleaseResource(DrivingControlResource);
#line 4342
  TerminateTask();
#line 4343
  return;
}
}
#line 4373
extern int ( /* missing proto */  colorsensor_init)() ;
#line 4387
extern int ( /* missing proto */  colorsensor_color_get)() ;
#line 4389
extern int ( /* missing proto */  colorsensor_rgb_get)() ;
#line 4391
extern int ( /* missing proto */  colorsensor_light_get)() ;
#line 4394
extern int ( /* missing proto */  colorsensor_light_full)() ;
#line 4346 "sumo/sumoR.c"
void TaskMainColorSensorTask(void) 
{ 
  U16___3 color ;
  U16___3 tmp ;
  int priority3 ;
  int speed_left4 ;
  int speed_right5 ;
  int duration6 ;
  U8___1 port_id7 ;
  unsigned short ret_ecrobot_get_nxtcolorsensor_light8 ;
  int port_id9 ;
  NXTCOLORSENSOR_T *sd10 ;
  U8___1 mode11 ;
  int tmp12 ;
  int tmp___013 ;

  {
#line 4363
  if (InSetupPhase) {
#line 4364
    TerminateTask();
  }
#line 4366
  port_id9 = 0;
#line 4367
  while (port_id9 < 4) {
#line 4368
    sd10 = & sensor_data[port_id9];
#line 4369
    if (sd10->port_in_use) {
#line 4370
      mode11 = (U8___1 )sd10->mode;
#line 4371
      if ((int )mode11 == 6) {
#line 4372
        sd10->port_in_use = (U8___1 volatile   )0;
#line 4373
        colorsensor_init(port_id9, 136);
#line 4374
        goto Lret_ecrobot_process_bg_nxtcolorsensor;
      } else
#line 4376
      if ((int )mode11 != (int )sd10->mode_state) {
#line 4377
        sd10->color = (U16___1 )99;
#line 4378
        sd10->rgb[0] = (S16___0 )0;
#line 4379
        sd10->rgb[1] = (S16___0 )0;
#line 4380
        sd10->rgb[2] = (S16___0 )0;
#line 4381
        sd10->light = (U16___1 )0;
#line 4382
        sd10->mode_state = (U8___1 volatile   )mode11;
#line 4383
        colorsensor_init(port_id9, 136);
#line 4384
        colorsensor_init(port_id9, (int )((unsigned char )NXT_COLORSENSOR_PROTOCOLS[mode11]));
      }
#line 4386
      if ((int )mode11 == 0) {
#line 4387
        tmp12 = colorsensor_color_get(port_id9);
#line 4388
        sd10->color = (U16___1 )tmp12;
#line 4389
        colorsensor_rgb_get(port_id9, sd10->rgb);
      } else {
#line 4391
        tmp___013 = colorsensor_light_get(port_id9);
#line 4392
        sd10->light = (U16___1 )tmp___013;
#line 4393
        if ((int )mode11 == 4) {
#line 4394
          colorsensor_light_full(port_id9);
        }
      }
    }
#line 4398
    port_id9 ++;
  }
#line 4400
  goto Lret_ecrobot_process_bg_nxtcolorsensor;
  Lret_ecrobot_process_bg_nxtcolorsensor: 
#line 4402
  port_id7 = (U8___3 )0;
#line 4403
  ret_ecrobot_get_nxtcolorsensor_light8 = sensor_data[port_id7].light;
#line 4404
  goto Lret_ecrobot_get_nxtcolorsensor_light;
  Lret_ecrobot_get_nxtcolorsensor_light: 
#line 4406
  tmp = ret_ecrobot_get_nxtcolorsensor_light8;
#line 4407
  color = tmp;
#line 4408
  if ((int )color < 300) {
#line 4409
    GetResource(DrivingControlResource);
#line 4410
    priority3 = 50;
#line 4411
    speed_left4 = -100;
#line 4412
    speed_right5 = -100;
#line 4413
    duration6 = 1250;
#line 4414
    GetResource(DrivingControlResource);
#line 4415
    if (dc.priority != 20) {
#line 4416
      SeekStarted = (U32___4 )0;
    }
#line 4418
    if (priority3 >= dc.priority) {
#line 4419
      dc.priority = priority3;
#line 4420
      dc.speed_left = (S32___1 )speed_left4;
#line 4421
      dc.speed_right = (S32___1 )speed_right5;
#line 4422
      dc.duration = (U32___4 )duration6;
    }
#line 4424
    ReleaseResource(DrivingControlResource);
#line 4425
    goto Lret_change_driving_command;
    Lret_change_driving_command: 
#line 4427
    ReleaseResource(DrivingControlResource);
  }
#line 4429
  TerminateTask();
#line 4430
  return;
}
}
#line 4433
extern int copysign() ;
#line 4521
extern int ( /* missing proto */  memset)() ;
#line 4434 "sumo/sumoR.c"
void TaskMainSonarSensorTask(void) 
{ 
  int duration ;
  S32___1 distance ;
  S32___1 tmp ;
  int seek_delay_1 ;
  int seek_delay_2 ;
  int seek_delay_3 ;
  int seek_delay_4 ;
  int speed_left ;
  int speed_right ;
  int modifier ;
  int tmp___0 ;
  int tmp___1 ;
  U32___4 current_sys_tick ;
  U32___4 tmp___2 ;
  U32___4 delta ;
  int priority16 ;
  int speed_left17 ;
  int speed_right18 ;
  int duration19 ;
  int priority20 ;
  int speed_left21 ;
  int speed_right22 ;
  int duration23 ;
  int priority24 ;
  int speed_left25 ;
  int speed_right26 ;
  int duration27 ;
  int priority28 ;
  int speed_left29 ;
  int speed_right30 ;
  int duration31 ;
  int priority32 ;
  int speed_left33 ;
  int speed_right34 ;
  int duration35 ;
  int priority36 ;
  int speed_left37 ;
  int speed_right38 ;
  int duration39 ;
  U8___1 port_id40 ;
  int tmp41 ;
  long ret_ecrobot_get_sonar_sensor42 ;
  int port43 ;
  U32___0 address44 ;
  int internal_address45 ;
  int n_internal_address_bytes46 ;
  U8___0 *data47 ;
  U32___0 nbytes48 ;
  int write49 ;
  struct i2c_port_struct *p50 ;
  struct i2c_partial_transaction *pt51 ;
  int tmp52 ;
  int tmp___053 ;

  {
#line 4491
  if (InSetupPhase) {
#line 4492
    TerminateTask();
  }
#line 4494
  duration = 3000;
#line 4495
  port_id40 = (U8___3 )1;
#line 4496
  tmp41 = i2c_busy((int )port_id40);
#line 4497
  if (tmp41 == 0) {
#line 4499
    port43 = (int )port_id40;
#line 4500
    address44 = (U32___1 )1;
#line 4501
    internal_address45 = 66;
#line 4502
    n_internal_address_bytes46 = 1;
#line 4504
    nbytes48 = (U32___1 )1;
#line 4505
    write49 = 0;
#line 4506
    if (port43 < 0) {
#line 4507
      goto Lret_i2c_start_transaction;
    } else
#line 4509
    if (port43 >= 4) {
#line 4510
      goto Lret_i2c_start_transaction;
    }
#line 4512
    tmp52 = i2c_busy(port43);
#line 4513
    if (tmp52) {
#line 4514
      goto Lret_i2c_start_transaction;
    }
#line 4516
    p50 = & i2c_port[port43];
#line 4517
    p50->pt_num = (U32___0 )0;
#line 4518
    p50->pt_begun = (U32___0 )0;
#line 4519
    pt51 = p50->partial_transaction;
#line 4520
    p50->current_pt = pt51;
#line 4521
    memset((void *)pt51, 0, sizeof(p50->partial_transaction));
#line 4522
    if (n_internal_address_bytes46 > 0) {
#line 4523
      p50->addr_int[0] = (U8___0 )(address44 << 1);
#line 4524
      p50->addr_int[1] = (U8___0 )internal_address45;
#line 4525
      pt51->start = (U8___0 )1;
#line 4526
      if (write49) {
#line 4527
        pt51->stop = (U8___0 )0;
      } else {
#line 4529
        pt51->stop = (U8___0 )1;
      }
#line 4531
      pt51->tx = (U8___0 )1;
#line 4532
      pt51->data = p50->addr_int;
#line 4533
      pt51->nbytes = (U16___0 )2;
#line 4534
      pt51 ++;
    }
#line 4536
    if (n_internal_address_bytes46 == 0) {
#line 4537
      goto _L___2;
    } else
#line 4539
    if (! write49) {
      _L___2: 
#line 4541
      if (n_internal_address_bytes46 > 0) {
#line 4542
        pt51->start = (U8___0 )0;
      } else {
#line 4544
        pt51->start = (U8___0 )1;
      }
#line 4546
      pt51->restart = (U8___0 )(! pt51->start);
#line 4547
      pt51->stop = (U8___0 )0;
#line 4548
      pt51->tx = (U8___0 )1;
#line 4549
      if (write49) {
#line 4550
        tmp___053 = 0;
      } else {
#line 4552
        tmp___053 = 1;
      }
#line 4554
      p50->addr = (U8___0 )((address44 << 1) | (unsigned long )tmp___053);
#line 4555
      pt51->data = & p50->addr;
#line 4556
      pt51->nbytes = (U16___0 )1;
#line 4557
      pt51 ++;
    }
#line 4559
    pt51->start = (U8___0 )0;
#line 4560
    pt51->stop = (U8___0 )1;
#line 4561
    if (write49) {
#line 4562
      pt51->tx = (U8___0 )1;
    } else {
#line 4564
      pt51->tx = (U8___0 )0;
    }
#line 4566
    pt51->data = data47;
#line 4567
    pt51->nbytes = (U16___0 )nbytes48;
#line 4568
    pt51->last_pt = (U8___0 )1;
#line 4569
    p50->state = (i2c_port_state )2;
#line 4570
    goto Lret_i2c_start_transaction;
    Lret_i2c_start_transaction: ;
  }
#line 4573
  ret_ecrobot_get_sonar_sensor42 = distance_state[port_id40];
#line 4574
  goto Lret_ecrobot_get_sonar_sensor;
  Lret_ecrobot_get_sonar_sensor: 
#line 4576
  tmp = ret_ecrobot_get_sonar_sensor42;
#line 4577
  distance = tmp;
#line 4578
  if (LastSonarValue == 0L) {
#line 4579
    LastSonarValue = (S32___1 )255;
  }
#line 4581
  if (distance == 255L) {
#line 4582
    if (LastSonarValue < 20L) {
#line 4583
      priority16 = 30;
#line 4584
      speed_left17 = 100;
#line 4585
      speed_right18 = 100;
#line 4586
      duration19 = 150;
#line 4587
      GetResource(DrivingControlResource);
#line 4588
      if (dc.priority != 20) {
#line 4589
        SeekStarted = (U32___4 )0;
      }
#line 4591
      if (priority16 >= dc.priority) {
#line 4592
        dc.priority = priority16;
#line 4593
        dc.speed_left = (S32___1 )speed_left17;
#line 4594
        dc.speed_right = (S32___1 )speed_right18;
#line 4595
        dc.duration = (U32___4 )duration19;
      }
#line 4597
      ReleaseResource(DrivingControlResource);
#line 4598
      goto Lret_change_driving_command;
      Lret_change_driving_command: ;
    } else {
#line 4601
      LastSonarValue = distance;
    }
  } else {
#line 4604
    LastSonarValue = distance;
  }
#line 4606
  seek_delay_1 = 1000;
#line 4607
  seek_delay_2 = seek_delay_1 * 2;
#line 4608
  seek_delay_3 = seek_delay_2 * 2;
#line 4609
  seek_delay_4 = seek_delay_3 + 2000;
#line 4610
  if (distance > 70L) {
#line 4611
    if (SeekStarted == 0UL) {
#line 4612
      SeekStarted = systick_get_ms();
#line 4613
      tmp___0 = rand();
#line 4614
      tmp___1 = copysign(1, tmp___0 - 1073741823);
#line 4615
      modifier = tmp___1;
#line 4616
      speed_left = -70 * modifier;
#line 4617
      speed_right = 70 * modifier;
#line 4618
      priority20 = 20;
#line 4619
      speed_left21 = speed_left;
#line 4620
      speed_right22 = speed_right;
#line 4621
      duration23 = duration;
#line 4622
      GetResource(DrivingControlResource);
#line 4623
      if (dc.priority != 20) {
#line 4624
        SeekStarted = (U32___4 )0;
      }
#line 4626
      if (priority20 >= dc.priority) {
#line 4627
        dc.priority = priority20;
#line 4628
        dc.speed_left = (S32___1 )speed_left21;
#line 4629
        dc.speed_right = (S32___1 )speed_right22;
#line 4630
        dc.duration = (U32___4 )duration23;
      }
#line 4632
      ReleaseResource(DrivingControlResource);
#line 4633
      goto Lret_change_driving_command___0;
      Lret_change_driving_command___0: ;
    } else {
#line 4636
      tmp___2 = systick_get_ms();
#line 4637
      current_sys_tick = tmp___2;
#line 4638
      delta = current_sys_tick - SeekStarted;
#line 4639
      if (delta > (U32___4 )seek_delay_1) {
#line 4640
        if (delta <= (U32___4 )(seek_delay_1 + 100)) {
#line 4641
          GetResource(DrivingControlResource);
#line 4642
          speed_left = (int )(dc.speed_left * -1L);
#line 4643
          speed_right = (int )(dc.speed_right * -1L);
#line 4644
          ReleaseResource(DrivingControlResource);
#line 4645
          priority24 = 20;
#line 4646
          speed_left25 = speed_left;
#line 4647
          speed_right26 = speed_right;
#line 4648
          duration27 = duration;
#line 4649
          GetResource(DrivingControlResource);
#line 4650
          if (dc.priority != 20) {
#line 4651
            SeekStarted = (U32___4 )0;
          }
#line 4653
          if (priority24 >= dc.priority) {
#line 4654
            dc.priority = priority24;
#line 4655
            dc.speed_left = (S32___1 )speed_left25;
#line 4656
            dc.speed_right = (S32___1 )speed_right26;
#line 4657
            dc.duration = (U32___4 )duration27;
          }
#line 4659
          ReleaseResource(DrivingControlResource);
#line 4660
          goto Lret_change_driving_command___1;
          Lret_change_driving_command___1: ;
        } else {
#line 4663
          goto _L___1;
        }
      } else
      _L___1: 
#line 4667
      if (delta > (U32___4 )seek_delay_2) {
#line 4668
        if (delta <= (U32___4 )(seek_delay_2 + 100)) {
#line 4669
          GetResource(DrivingControlResource);
#line 4670
          speed_left = (int )(dc.speed_left * -1L);
#line 4671
          speed_right = (int )(dc.speed_right * -1L);
#line 4672
          ReleaseResource(DrivingControlResource);
#line 4673
          priority28 = 20;
#line 4674
          speed_left29 = speed_left;
#line 4675
          speed_right30 = speed_right;
#line 4676
          duration31 = duration;
#line 4677
          GetResource(DrivingControlResource);
#line 4678
          if (dc.priority != 20) {
#line 4679
            SeekStarted = (U32___4 )0;
          }
#line 4681
          if (priority28 >= dc.priority) {
#line 4682
            dc.priority = priority28;
#line 4683
            dc.speed_left = (S32___1 )speed_left29;
#line 4684
            dc.speed_right = (S32___1 )speed_right30;
#line 4685
            dc.duration = (U32___4 )duration31;
          }
#line 4687
          ReleaseResource(DrivingControlResource);
#line 4688
          goto Lret_change_driving_command___2;
          Lret_change_driving_command___2: ;
        } else {
#line 4691
          goto _L___0;
        }
      } else
      _L___0: 
#line 4695
      if (delta > (U32___4 )seek_delay_3) {
#line 4696
        if (delta <= (U32___4 )seek_delay_4) {
#line 4697
          speed_left = 100;
#line 4698
          speed_right = 100;
#line 4699
          priority32 = 20;
#line 4700
          speed_left33 = speed_left;
#line 4701
          speed_right34 = speed_right;
#line 4702
          duration35 = duration;
#line 4703
          GetResource(DrivingControlResource);
#line 4704
          if (dc.priority != 20) {
#line 4705
            SeekStarted = (U32___4 )0;
          }
#line 4707
          if (priority32 >= dc.priority) {
#line 4708
            dc.priority = priority32;
#line 4709
            dc.speed_left = (S32___1 )speed_left33;
#line 4710
            dc.speed_right = (S32___1 )speed_right34;
#line 4711
            dc.duration = (U32___4 )duration35;
          }
#line 4713
          ReleaseResource(DrivingControlResource);
#line 4714
          goto Lret_change_driving_command___3;
          Lret_change_driving_command___3: ;
        } else {
#line 4717
          goto _L;
        }
      } else
      _L: 
#line 4721
      if (delta > (U32___4 )seek_delay_4) {
#line 4722
        SeekStarted = (U32___4 )0;
      }
    }
  } else {
#line 4726
    priority36 = 30;
#line 4727
    speed_left37 = 100;
#line 4728
    speed_right38 = 100;
#line 4729
    duration39 = 150;
#line 4730
    GetResource(DrivingControlResource);
#line 4731
    if (dc.priority != 20) {
#line 4732
      SeekStarted = (U32___4 )0;
    }
#line 4734
    if (priority36 >= dc.priority) {
#line 4735
      dc.priority = priority36;
#line 4736
      dc.speed_left = (S32___1 )speed_left37;
#line 4737
      dc.speed_right = (S32___1 )speed_right38;
#line 4738
      dc.duration = (U32___4 )duration39;
    }
#line 4740
    ReleaseResource(DrivingControlResource);
#line 4741
    goto Lret_change_driving_command___4;
    Lret_change_driving_command___4: ;
  }
#line 4744
  TerminateTask();
#line 4745
  return;
}
}
#line 4932
extern int ( /* missing proto */  display_unsigned_worker)() ;
#line 4748 "sumo/sumoR.c"
void TaskMainDisplayTask(void) 
{ 
  U32___4 tmp ;
  U16___3 color ;
  U16___3 tmp___0 ;
  S32___1 sonar ;
  S32___1 tmp___1 ;
  U8___1 port_id6 ;
  int tmp7 ;
  long ret_ecrobot_get_sonar_sensor8 ;
  U8___1 port_id9 ;
  unsigned short ret_ecrobot_get_nxtcolorsensor_light10 ;
  int port11 ;
  U32___0 address12 ;
  int internal_address13 ;
  int n_internal_address_bytes14 ;
  U8___0 *data15 ;
  U32___0 nbytes16 ;
  int write17 ;
  struct i2c_port_struct *p18 ;
  struct i2c_partial_transaction *pt19 ;
  int tmp20 ;
  int tmp___021 ;
  int x22 ;
  int y23 ;
  int x24 ;
  int y25 ;
  int x26 ;
  int y27 ;
  int x28 ;
  int y29 ;
  int x30 ;
  int y31 ;
  int x32 ;
  int y33 ;
  int x34 ;
  int y35 ;
  char const   *str36 ;
  char const   *str37 ;
  char const   *str38 ;
  char const   *str39 ;
  char const   *str40 ;
  char const   *str41 ;
  char const   *str42 ;
  char const   *str43 ;
  char const   *str44 ;
  char const   *str45 ;
  char const   *str46 ;
  char const   *str47 ;
  char const   *str48 ;
  int val49 ;
  U32 places50 ;
  int tmp51 ;
  int val52 ;
  U32 places53 ;
  int tmp54 ;
  int val55 ;
  U32 places56 ;
  int tmp57 ;
  int val58 ;
  U32 places59 ;
  int tmp60 ;
  int val61 ;
  U32 places62 ;
  int tmp63 ;
  int val64 ;
  U32 places65 ;
  int tmp66 ;
  int val67 ;
  U32 places68 ;
  int tmp69 ;
  int val70 ;
  U32 places71 ;
  int tmp72 ;

  {
#line 4824
  if (InSetupPhase) {
#line 4825
    TerminateTask();
  }
#line 4827
  display_clear((U32___4 )0);
#line 4828
  GetResource(DrivingControlResource);
#line 4829
  x22 = 0;
#line 4830
  y23 = 0;
#line 4831
  display_x = x22;
#line 4832
  display_y = y23;
#line 4833
  goto Lret_display_goto_xy;
  Lret_display_goto_xy: 
#line 4835
  str36 = "PRIO: ";
#line 4836
  while (*str36) {
#line 4837
    if ((int const   )*str36 != 10) {
#line 4838
      display_char((int )*str36);
#line 4839
      display_x ++;
    } else {
#line 4841
      display_x = 0;
#line 4842
      display_y ++;
    }
#line 4844
    str36 ++;
  }
#line 4846
  goto Lret_display_string;
  Lret_display_string: ;
#line 4848
  switch (dc.priority) {
  case 5: 
#line 4850
  str37 = "IDLE";
#line 4851
  while (*str37) {
#line 4852
    if ((int const   )*str37 != 10) {
#line 4853
      display_char((int )*str37);
#line 4854
      display_x ++;
    } else {
#line 4856
      display_x = 0;
#line 4857
      display_y ++;
    }
#line 4859
    str37 ++;
  }
#line 4861
  goto Lret_display_string___0;
  Lret_display_string___0: ;
#line 4863
  break;
  case 20: 
#line 4865
  str38 = "SEEK";
#line 4866
  while (*str38) {
#line 4867
    if ((int const   )*str38 != 10) {
#line 4868
      display_char((int )*str38);
#line 4869
      display_x ++;
    } else {
#line 4871
      display_x = 0;
#line 4872
      display_y ++;
    }
#line 4874
    str38 ++;
  }
#line 4876
  goto Lret_display_string___1;
  Lret_display_string___1: ;
#line 4878
  break;
  case 30: 
#line 4880
  str39 = "FOLLOW";
#line 4881
  while (*str39) {
#line 4882
    if ((int const   )*str39 != 10) {
#line 4883
      display_char((int )*str39);
#line 4884
      display_x ++;
    } else {
#line 4886
      display_x = 0;
#line 4887
      display_y ++;
    }
#line 4889
    str39 ++;
  }
#line 4891
  goto Lret_display_string___2;
  Lret_display_string___2: ;
#line 4893
  break;
  case 50: 
#line 4895
  str40 = "COLOR";
#line 4896
  while (*str40) {
#line 4897
    if ((int const   )*str40 != 10) {
#line 4898
      display_char((int )*str40);
#line 4899
      display_x ++;
    } else {
#line 4901
      display_x = 0;
#line 4902
      display_y ++;
    }
#line 4904
    str40 ++;
  }
#line 4906
  goto Lret_display_string___3;
  Lret_display_string___3: ;
#line 4908
  break;
  default: 
#line 4910
  str41 = "WTF: ";
#line 4911
  while (*str41) {
#line 4912
    if ((int const   )*str41 != 10) {
#line 4913
      display_char((int )*str41);
#line 4914
      display_x ++;
    } else {
#line 4916
      display_x = 0;
#line 4917
      display_y ++;
    }
#line 4919
    str41 ++;
  }
#line 4921
  goto Lret_display_string___4;
  Lret_display_string___4: 
#line 4924
  val49 = dc.priority;
#line 4925
  places50 = (U32___4 )3;
#line 4927
  if (val49 < 0) {
#line 4928
    tmp51 = - val49;
  } else {
#line 4930
    tmp51 = val49;
  }
#line 4932
  display_unsigned_worker((U32 )tmp51, places50, (U32 )(val49 < 0));
#line 4933
  goto Lret_display_int;
  Lret_display_int: ;
#line 4937
  break;
  }
#line 4939
  x24 = 0;
#line 4940
  y25 = 1;
#line 4941
  display_x = x24;
#line 4942
  display_y = y25;
#line 4943
  goto Lret_display_goto_xy___0;
  Lret_display_goto_xy___0: 
#line 4945
  str42 = "SPEED L/R: ";
#line 4946
  while (*str42) {
#line 4947
    if ((int const   )*str42 != 10) {
#line 4948
      display_char((int )*str42);
#line 4949
      display_x ++;
    } else {
#line 4951
      display_x = 0;
#line 4952
      display_y ++;
    }
#line 4954
    str42 ++;
  }
#line 4956
  goto Lret_display_string___5;
  Lret_display_string___5: 
#line 4958
  x26 = 0;
#line 4959
  y27 = 2;
#line 4960
  display_x = x26;
#line 4961
  display_y = y27;
#line 4962
  goto Lret_display_goto_xy___1;
  Lret_display_goto_xy___1: 
#line 4965
  val52 = (int )dc.speed_left;
#line 4966
  places53 = (U32___4 )4;
#line 4968
  if (val52 < 0) {
#line 4969
    tmp54 = - val52;
  } else {
#line 4971
    tmp54 = val52;
  }
#line 4973
  display_unsigned_worker((U32 )tmp54, places53, (U32 )(val52 < 0));
#line 4974
  goto Lret_display_int___0;
  Lret_display_int___0: 
#line 4977
  str43 = "/";
#line 4979
  while (*str43) {
#line 4980
    if ((int const   )*str43 != 10) {
#line 4981
      display_char((int )*str43);
#line 4982
      display_x ++;
    } else {
#line 4984
      display_x = 0;
#line 4985
      display_y ++;
    }
#line 4987
    str43 ++;
  }
#line 4989
  goto Lret_display_string___6;
  Lret_display_string___6: 
#line 4992
  val55 = (int )dc.speed_right;
#line 4993
  places56 = (U32___4 )4;
#line 4995
  if (val55 < 0) {
#line 4996
    tmp57 = - val55;
  } else {
#line 4998
    tmp57 = val55;
  }
#line 5000
  display_unsigned_worker((U32 )tmp57, places56, (U32 )(val55 < 0));
#line 5001
  goto Lret_display_int___1;
  Lret_display_int___1: 
#line 5004
  x28 = 0;
#line 5005
  y29 = 3;
#line 5006
  display_x = x28;
#line 5007
  display_y = y29;
#line 5009
  goto Lret_display_goto_xy___2;
  Lret_display_goto_xy___2: 
#line 5011
  str44 = "DURATION: ";
#line 5012
  while (*str44) {
#line 5013
    if ((int const   )*str44 != 10) {
#line 5014
      display_char((int )*str44);
#line 5015
      display_x ++;
    } else {
#line 5017
      display_x = 0;
#line 5018
      display_y ++;
    }
#line 5020
    str44 ++;
  }
#line 5022
  goto Lret_display_string___7;
  Lret_display_string___7: 
#line 5025
  val58 = (int )dc.duration;
#line 5026
  places59 = (U32___4 )0;
#line 5028
  if (val58 < 0) {
#line 5029
    tmp60 = - val58;
  } else {
#line 5031
    tmp60 = val58;
  }
#line 5033
  display_unsigned_worker((U32 )tmp60, places59, (U32 )(val58 < 0));
#line 5034
  goto Lret_display_int___2;
  Lret_display_int___2: 
#line 5037
  ReleaseResource(DrivingControlResource);
#line 5038
  x30 = 0;
#line 5039
  y31 = 4;
#line 5040
  display_x = x30;
#line 5041
  display_y = y31;
#line 5043
  goto Lret_display_goto_xy___3;
  Lret_display_goto_xy___3: 
#line 5045
  str45 = "SYSTEM: ";
#line 5046
  while (*str45) {
#line 5047
    if ((int const   )*str45 != 10) {
#line 5048
      display_char((int )*str45);
#line 5049
      display_x ++;
    } else {
#line 5051
      display_x = 0;
#line 5052
      display_y ++;
    }
#line 5054
    str45 ++;
  }
#line 5056
  goto Lret_display_string___8;
  Lret_display_string___8: 
#line 5059
  tmp = systick_get_ms();
#line 5060
  val61 = (int )tmp;
#line 5061
  places62 = (U32___4 )0;
#line 5063
  if (val61 < 0) {
#line 5064
    tmp63 = - val61;
  } else {
#line 5066
    tmp63 = val61;
  }
#line 5068
  display_unsigned_worker((U32 )tmp63, places62, (U32 )(val61 < 0));
#line 5069
  goto Lret_display_int___3;
  Lret_display_int___3: 
#line 5072
  port_id9 = (U8___3 )0;
#line 5073
  ret_ecrobot_get_nxtcolorsensor_light10 = sensor_data[port_id9].light;
#line 5075
  goto Lret_ecrobot_get_nxtcolorsensor_light;
  Lret_ecrobot_get_nxtcolorsensor_light: 
#line 5077
  tmp___0 = ret_ecrobot_get_nxtcolorsensor_light10;
#line 5078
  color = tmp___0;
#line 5079
  x32 = 0;
#line 5080
  y33 = 5;
#line 5081
  display_x = x32;
#line 5082
  display_y = y33;
#line 5083
  goto Lret_display_goto_xy___4;
  Lret_display_goto_xy___4: 
#line 5085
  str46 = "COLOR: ";
#line 5086
  while (*str46) {
#line 5087
    if ((int const   )*str46 != 10) {
#line 5088
      display_char((int )*str46);
#line 5089
      display_x ++;
    } else {
#line 5091
      display_x = 0;
#line 5092
      display_y ++;
    }
#line 5094
    str46 ++;
  }
#line 5096
  goto Lret_display_string___9;
  Lret_display_string___9: 
#line 5099
  val64 = (int )color;
#line 5100
  places65 = (U32___4 )0;
#line 5102
  if (val64 < 0) {
#line 5103
    tmp66 = - val64;
  } else {
#line 5105
    tmp66 = val64;
  }
#line 5107
  display_unsigned_worker((U32 )tmp66, places65, (U32 )(val64 < 0));
#line 5108
  goto Lret_display_int___4;
  Lret_display_int___4: 
#line 5111
  port_id6 = (U8___3 )1;
#line 5112
  tmp7 = i2c_busy((int )port_id6);
#line 5114
  if (tmp7 == 0) {
#line 5116
    port11 = (int )port_id6;
#line 5117
    address12 = (U32___1 )1;
#line 5118
    internal_address13 = 66;
#line 5119
    n_internal_address_bytes14 = 1;
#line 5121
    nbytes16 = (U32___1 )1;
#line 5122
    write17 = 0;
#line 5123
    if (port11 < 0) {
#line 5124
      goto Lret_i2c_start_transaction;
    } else
#line 5126
    if (port11 >= 4) {
#line 5127
      goto Lret_i2c_start_transaction;
    }
#line 5129
    tmp20 = i2c_busy(port11);
#line 5130
    if (tmp20) {
#line 5131
      goto Lret_i2c_start_transaction;
    }
#line 5133
    p18 = & i2c_port[port11];
#line 5134
    p18->pt_num = (U32___0 )0;
#line 5135
    p18->pt_begun = (U32___0 )0;
#line 5136
    pt19 = p18->partial_transaction;
#line 5137
    p18->current_pt = pt19;
#line 5138
    memset((void *)pt19, 0, sizeof(p18->partial_transaction));
#line 5139
    if (n_internal_address_bytes14 > 0) {
#line 5140
      p18->addr_int[0] = (U8___0 )(address12 << 1);
#line 5141
      p18->addr_int[1] = (U8___0 )internal_address13;
#line 5142
      pt19->start = (U8___0 )1;
#line 5143
      if (write17) {
#line 5144
        pt19->stop = (U8___0 )0;
      } else {
#line 5146
        pt19->stop = (U8___0 )1;
      }
#line 5148
      pt19->tx = (U8___0 )1;
#line 5149
      pt19->data = p18->addr_int;
#line 5150
      pt19->nbytes = (U16___0 )2;
#line 5151
      pt19 ++;
    }
#line 5153
    if (n_internal_address_bytes14 == 0) {
#line 5154
      goto _L;
    } else
#line 5156
    if (! write17) {
      _L: 
#line 5158
      if (n_internal_address_bytes14 > 0) {
#line 5159
        pt19->start = (U8___0 )0;
      } else {
#line 5161
        pt19->start = (U8___0 )1;
      }
#line 5163
      pt19->restart = (U8___0 )(! pt19->start);
#line 5164
      pt19->stop = (U8___0 )0;
#line 5165
      pt19->tx = (U8___0 )1;
#line 5166
      if (write17) {
#line 5167
        tmp___021 = 0;
      } else {
#line 5169
        tmp___021 = 1;
      }
#line 5171
      p18->addr = (U8___0 )((address12 << 1) | (unsigned long )tmp___021);
#line 5172
      pt19->data = & p18->addr;
#line 5173
      pt19->nbytes = (U16___0 )1;
#line 5174
      pt19 ++;
    }
#line 5176
    pt19->start = (U8___0 )0;
#line 5177
    pt19->stop = (U8___0 )1;
#line 5178
    if (write17) {
#line 5179
      pt19->tx = (U8___0 )1;
    } else {
#line 5181
      pt19->tx = (U8___0 )0;
    }
#line 5183
    pt19->data = data15;
#line 5184
    pt19->nbytes = (U16___0 )nbytes16;
#line 5185
    pt19->last_pt = (U8___0 )1;
#line 5186
    p18->state = (i2c_port_state )2;
#line 5187
    goto Lret_i2c_start_transaction;
    Lret_i2c_start_transaction: ;
  }
#line 5190
  ret_ecrobot_get_sonar_sensor8 = distance_state[port_id6];
#line 5191
  goto Lret_ecrobot_get_sonar_sensor;
  Lret_ecrobot_get_sonar_sensor: 
#line 5193
  tmp___1 = ret_ecrobot_get_sonar_sensor8;
#line 5194
  sonar = tmp___1;
#line 5195
  x34 = 0;
#line 5196
  y35 = 6;
#line 5197
  display_x = x34;
#line 5198
  display_y = y35;
#line 5199
  goto Lret_display_goto_xy___5;
  Lret_display_goto_xy___5: 
#line 5201
  str47 = "SONAR: ";
#line 5202
  while (*str47) {
#line 5203
    if ((int const   )*str47 != 10) {
#line 5204
      display_char((int )*str47);
#line 5205
      display_x ++;
    } else {
#line 5207
      display_x = 0;
#line 5208
      display_y ++;
    }
#line 5210
    str47 ++;
  }
#line 5212
  goto Lret_display_string___10;
  Lret_display_string___10: 
#line 5215
  val67 = (int )sonar;
#line 5216
  places68 = (U32___4 )0;
#line 5218
  if (val67 < 0) {
#line 5219
    tmp69 = - val67;
  } else {
#line 5221
    tmp69 = val67;
  }
#line 5223
  display_unsigned_worker((U32 )tmp69, places68, (U32 )(val67 < 0));
#line 5224
  goto Lret_display_int___5;
  Lret_display_int___5: 
#line 5227
  str48 = " / ";
#line 5229
  while (*str48) {
#line 5230
    if ((int const   )*str48 != 10) {
#line 5231
      display_char((int )*str48);
#line 5232
      display_x ++;
    } else {
#line 5234
      display_x = 0;
#line 5235
      display_y ++;
    }
#line 5237
    str48 ++;
  }
#line 5239
  goto Lret_display_string___11;
  Lret_display_string___11: 
#line 5242
  val70 = (int )LastSonarValue;
#line 5243
  places71 = (U32___4 )0;
#line 5245
  if (val70 < 0) {
#line 5246
    tmp72 = - val70;
  } else {
#line 5248
    tmp72 = val70;
  }
#line 5250
  display_unsigned_worker((U32 )tmp72, places71, (U32 )(val70 < 0));
#line 5251
  goto Lret_display_int___6;
  Lret_display_int___6: 
#line 5254
  display_update();
#line 5255
  TerminateTask();
#line 5257
  return;
}
}
#line 5260
extern int create_block() ;
#line 5261
extern int create_task() ;
#line 5262 "sumo/sumoR.c"
void main(void) 
{ 


  {
#line 5268
  create_task("TaskMainDisplayTask", "TaskMainDisplayTask", 1, 250, 9.411);
#line 5269
  create_task("TaskMainColorSensorTask", "TaskMainColorSensorTask", 5, 100, 0.068);
#line 5270
  create_task("TaskMainSonarSensorTask", "TaskMainSonarSensorTask", 2, 100, 11.994);
#line 5271
  create_task("TaskMainMotorControlTask", "TaskMainMotorControlTask", 1, 50, 9.074);
#line 5272
  create_block(4278, "TaskMainMotorControlTask", "DrivingControlResource", 1, 1, 0.071);
#line 5273
  create_block(4409, "TaskMainColorSensorTask", "DrivingControlResource", 2, 2, 0.028);
#line 5274
  create_block(4414, "TaskMainColorSensorTask", "DrivingControlResource", 2, 2, 0.02);
#line 5275
  create_block(4828, "TaskMainDisplayTask", "DrivingControlResource", 1, 10, 0.22);
#line 5276
  create_block(4587, "TaskMainSonarSensorTask", "DrivingControlResource", 8, 5, 0.019);
#line 5277
  create_block(4622, "TaskMainSonarSensorTask", "DrivingControlResource", 8, 5, 0.018);
#line 5278
  create_block(4641, "TaskMainSonarSensorTask", "DrivingControlResource", 8, 5, 0.01);
#line 5279
  create_block(4649, "TaskMainSonarSensorTask", "DrivingControlResource", 8, 5, 0.018);
#line 5280
  create_block(4669, "TaskMainSonarSensorTask", "DrivingControlResource", 8, 5, 0.012);
#line 5281
  create_block(4677, "TaskMainSonarSensorTask", "DrivingControlResource", 8, 5, 0.019);
#line 5282
  create_block(4703, "TaskMainSonarSensorTask", "DrivingControlResource", 8, 5, 0.022);
#line 5283
  create_block(4730, "TaskMainSonarSensorTask", "DrivingControlResource", 8, 5, 0.019);
#line 5284
  return;
}
}
