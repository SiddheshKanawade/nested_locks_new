/* Generated by CIL v. 1.7.3 */
/* print_CIL_Input is true */

#line 3 "sumo/sumo.c"
typedef unsigned char U8;
#line 4 "sumo/sumo.c"
typedef unsigned long U32;
#line 45 "sumo/sumo.c"
typedef unsigned char U8___0;
#line 46 "sumo/sumo.c"
typedef unsigned short U16___0;
#line 47 "sumo/sumo.c"
typedef unsigned long U32___0;
#line 53 "sumo/sumo.c"
struct i2c_partial_transaction {
   U8___0 start : 1 ;
   U8___0 restart : 1 ;
   U8___0 stop : 1 ;
   U8___0 tx : 1 ;
   U8___0 last_pt : 1 ;
   U16___0 nbytes ;
   U8___0 *data ;
};
#line 62
enum __anonenum_i2c_port_state_506411302 {
    I2C_UNINITIALISED = 0,
    I2C_IDLE = 1,
    I2C_BEGIN = 2,
    I2C_RESTART1 = 3,
    I2C_START1 = 4,
    I2C_START2 = 5,
    I2C_START3 = 6,
    I2C_START_RECLOCK1 = 7,
    I2C_LOW0 = 8,
    I2C_LOW1 = 9,
    I2C_HIGH0 = 10,
    I2C_HIGH1 = 11,
    I2C_STOP0 = 12,
    I2C_STOP1 = 13,
    I2C_STOP2 = 14,
    I2C_STOP3 = 15
} ;
#line 80 "sumo/sumo.c"
typedef enum __anonenum_i2c_port_state_506411302 i2c_port_state;
#line 81 "sumo/sumo.c"
struct i2c_port_struct {
   U32___0 scl_pin ;
   U32___0 sda_pin ;
   U8___0 addr_int[2] ;
   U8___0 addr ;
   struct i2c_partial_transaction partial_transaction[3] ;
   struct i2c_partial_transaction *current_pt ;
   i2c_port_state state ;
   U32___0 nbits ;
   U32___0 ack_slot ;
   U32___0 ack_slot_pending ;
   U8___0 *dataN ;
   U32___0 transmitting ;
   U32___0 fault ;
   U32___0 n_fault ;
   U32___0 n_good ;
   U32___0 ack_fail ;
   U32___0 ack_good ;
   U32___0 pt_num ;
   U32___0 pt_begun ;
};
#line 102 "sumo/sumo.c"
typedef unsigned char U8___1;
#line 104 "sumo/sumo.c"
typedef unsigned short U16___1;
#line 105 "sumo/sumo.c"
typedef short S16___0;
#line 106 "sumo/sumo.c"
typedef unsigned long U32___1;
#line 107 "sumo/sumo.c"
typedef long S32___0;
#line 258 "sumo/sumo.c"
struct __anonstruct_NXTCOLORSENSOR_T_371327434 {
   U16___1 color ;
   S16___0 rgb[3] ;
   U16___1 light ;
   U8___1 volatile   mode ;
   U8___1 volatile   mode_state ;
   U8___1 volatile   port_in_use ;
};
#line 266 "sumo/sumo.c"
typedef struct __anonstruct_NXTCOLORSENSOR_T_371327434 NXTCOLORSENSOR_T;
#line 267 "sumo/sumo.c"
typedef unsigned char U8___2;
#line 268 "sumo/sumo.c"
typedef signed char S8___1;
#line 270 "sumo/sumo.c"
typedef unsigned long U32___2;
#line 272 "sumo/sumo.c"
struct __anonstruct_to_avr_432250394 {
   U8___2 power ;
   U8___2 pwm_frequency ;
   S8___1 output_percent[4] ;
   U8___2 output_mode ;
   U8___2 input_power ;
} __attribute__((__packed__)) ;
#line 279 "sumo/sumo.c"
typedef struct __anonstruct_to_avr_432250394 to_avr;
#line 294 "sumo/sumo.c"
typedef unsigned long U32___3;
#line 296 "sumo/sumo.c"
struct motor_struct {
   int current_count ;
   int target_count ;
   int speed_percent ;
   U32___3 last ;
};
#line 302 "sumo/sumo.c"
typedef unsigned char UINT8;
#line 303 "sumo/sumo.c"
typedef UINT8 StatusType;
#line 304 "sumo/sumo.c"
typedef UINT8 ResourceType;
#line 305 "sumo/sumo.c"
typedef unsigned char U8___3;
#line 306 "sumo/sumo.c"
typedef unsigned short U16___3;
#line 307 "sumo/sumo.c"
typedef unsigned long U32___4;
#line 308 "sumo/sumo.c"
typedef long S32___1;
#line 309 "sumo/sumo.c"
struct dc_t {
   U32___4 duration ;
   S32___1 speed_left ;
   S32___1 speed_right ;
   int priority ;
};
#line 316
extern void display_update(void) ;
#line 318
extern void display_clear(U32 updateToo ) ;
#line 320
extern void display_char(int c ) ;
#line 329 "sumo/sumo.c"
int display_tick  ;
#line 330 "sumo/sumo.c"
int display_auto_update  ;
#line 336
extern unsigned long systick_get_ms(void) ;
#line 347 "sumo/sumo.c"
U8 const   *displayM  =    (U8 const   *)((U8 *)0);
#line 348 "sumo/sumo.c"
unsigned char volatile   dirty  =    (U8 volatile   )0;
#line 349 "sumo/sumo.c"
unsigned char volatile   page  =    (U8 volatile   )0;
#line 350 "sumo/sumo.c"
U8 const volatile   *dataM  =    (U8 const volatile   *)((U8 *)0);
#line 351 "sumo/sumo.c"
U8 mode  =    (U8 )255;
#line 1077 "sumo/sumo.c"
int display_x  ;
#line 1078 "sumo/sumo.c"
int display_y  ;
#line 1449
extern int i2c_busy(int port ) ;
#line 1456 "sumo/sumo.c"
static struct i2c_port_struct i2c_port[4]  ;
#line 2245 "sumo/sumo.c"
static S32___0 distance_state[4]  = {      (S32___0 )-1,      (S32___0 )-1,      (S32___0 )-1,      (S32___0 )-1};
#line 2285 "sumo/sumo.c"
U8___1 const   NXT_COLORSENSOR_PROTOCOLS[7]  = {      (U8___1 const   )176,      (U8___1 const   )112,      (U8___1 const   )240,      (U8___1 const   )8, 
        (U8___1 const   )176,      (U8___1 const   )136,      (U8___1 const   )136};
#line 2288 "sumo/sumo.c"
static NXTCOLORSENSOR_T sensor_data[4]  ;
#line 3845 "sumo/sumo.c"
static to_avr io_to_avr  ;
#line 4109 "sumo/sumo.c"
static struct motor_struct motor[3]  ;
#line 4251
extern  __attribute__((__nothrow__)) int ( __attribute__((__leaf__)) rand)(void) ;
#line 4252
extern StatusType TerminateTask(void) ;
#line 4253
extern StatusType GetResource(ResourceType resid ) ;
#line 4254
extern StatusType ReleaseResource(ResourceType resid ) ;
#line 4255
extern ResourceType DrivingControlResource ;
#line 4256 "sumo/sumo.c"
struct dc_t dc  =    {(U32___4 )0, (S32___1 )0, (S32___1 )0, 5};
#line 4257 "sumo/sumo.c"
U32___4 SeekStarted  ;
#line 4258 "sumo/sumo.c"
S32___1 LastSonarValue  ;
#line 4259 "sumo/sumo.c"
int InSetupPhase  ;
#line 4260 "sumo/sumo.c"
U32___4 SetupStarted  ;
#line 4261 "sumo/sumo.c"
void TaskMainMotorcontrolTask(void) 
{ 
  U32___3 n1 ;
  int speed_percent2 ;
  int brake3 ;
  U32___3 n4 ;
  int speed_percent5 ;
  int brake6 ;
  U32___2 n7 ;
  int power_percent8 ;
  int brake9 ;
  U32___2 n10 ;
  int power_percent11 ;
  int brake12 ;

  {
#line 4277
  if (InSetupPhase) {
#line 4278
    TerminateTask();
  }
#line 4280
  GetResource(DrivingControlResource);
#line 4281
  if (dc.duration > 0UL) {
#line 4282
    dc.duration -= 50UL;
  } else {
#line 4284
    dc.priority = 5;
#line 4285
    dc.duration = (U32___4 )0;
#line 4286
    dc.speed_left = (S32___1 )0;
#line 4287
    dc.speed_right = (S32___1 )0;
  }
#line 4289
  n1 = (U32___4 )1;
#line 4290
  speed_percent2 = (int )(- dc.speed_left);
#line 4291
  brake3 = 1;
#line 4292
  if (n1 < 3UL) {
#line 4293
    if (speed_percent2 > 100) {
#line 4294
      speed_percent2 = 100;
    }
#line 4296
    if (speed_percent2 < -100) {
#line 4297
      speed_percent2 = -100;
    }
#line 4299
    motor[n1].speed_percent = speed_percent2;
#line 4300
    n7 = n1;
#line 4301
    power_percent8 = speed_percent2;
#line 4302
    brake9 = brake3;
#line 4303
    if (n7 < 3UL) {
#line 4304
      io_to_avr.output_percent[n7] = (S8___1 )power_percent8;
#line 4305
      if (brake9) {
#line 4306
        io_to_avr.output_mode = (U8___2 )((int )io_to_avr.output_mode | (1 << n7));
      } else {
#line 4308
        io_to_avr.output_mode = (U8___2 )((int )io_to_avr.output_mode & ~ (1 << n7));
      }
    }
#line 4311
    goto Lret_nxt_avr_set_motor;
    Lret_nxt_avr_set_motor: ;
  }
#line 4314
  goto Lret_nxt_motor_set_speed;
  Lret_nxt_motor_set_speed: 
#line 4316
  n4 = (U32___4 )0;
#line 4317
  speed_percent5 = (int )(- dc.speed_right);
#line 4318
  brake6 = 1;
#line 4319
  if (n4 < 3UL) {
#line 4320
    if (speed_percent5 > 100) {
#line 4321
      speed_percent5 = 100;
    }
#line 4323
    if (speed_percent5 < -100) {
#line 4324
      speed_percent5 = -100;
    }
#line 4326
    motor[n4].speed_percent = speed_percent5;
#line 4327
    n10 = n4;
#line 4328
    power_percent11 = speed_percent5;
#line 4329
    brake12 = brake6;
#line 4330
    if (n10 < 3UL) {
#line 4331
      io_to_avr.output_percent[n10] = (S8___1 )power_percent11;
#line 4332
      if (brake12) {
#line 4333
        io_to_avr.output_mode = (U8___2 )((int )io_to_avr.output_mode | (1 << n10));
      } else {
#line 4335
        io_to_avr.output_mode = (U8___2 )((int )io_to_avr.output_mode & ~ (1 << n10));
      }
    }
#line 4338
    goto Lret_nxt_avr_set_motor___0;
    Lret_nxt_avr_set_motor___0: ;
  }
#line 4341
  goto Lret_nxt_motor_set_speed___0;
  Lret_nxt_motor_set_speed___0: 
#line 4343
  ReleaseResource(DrivingControlResource);
#line 4344
  TerminateTask();
#line 4345
  return;
}
}
#line 4375
extern int ( /* missing proto */  colorsensor_init)() ;
#line 4389
extern int ( /* missing proto */  colorsensor_color_get)() ;
#line 4391
extern int ( /* missing proto */  colorsensor_rgb_get)() ;
#line 4393
extern int ( /* missing proto */  colorsensor_light_get)() ;
#line 4396
extern int ( /* missing proto */  colorsensor_light_full)() ;
#line 4348 "sumo/sumo.c"
void TaskMainColorSensorTask(void) 
{ 
  U16___3 color ;
  U16___3 tmp ;
  int priority3 ;
  int speed_left4 ;
  int speed_right5 ;
  int duration6 ;
  U8___1 port_id7 ;
  unsigned short ret_ecrobot_get_nxtcolorsensor_light8 ;
  int port_id9 ;
  NXTCOLORSENSOR_T *sd10 ;
  U8___1 mode11 ;
  int tmp12 ;
  int tmp___013 ;

  {
#line 4365
  if (InSetupPhase) {
#line 4366
    TerminateTask();
  }
#line 4368
  port_id9 = 0;
#line 4369
  while (port_id9 < 4) {
#line 4370
    sd10 = & sensor_data[port_id9];
#line 4371
    if (sd10->port_in_use) {
#line 4372
      mode11 = (U8___1 )sd10->mode;
#line 4373
      if ((int )mode11 == 6) {
#line 4374
        sd10->port_in_use = (U8___1 volatile   )0;
#line 4375
        colorsensor_init(port_id9, 136);
#line 4376
        goto Lret_ecrobot_process_bg_nxtcolorsensor;
      } else
#line 4378
      if ((int )mode11 != (int )sd10->mode_state) {
#line 4379
        sd10->color = (U16___1 )99;
#line 4380
        sd10->rgb[0] = (S16___0 )0;
#line 4381
        sd10->rgb[1] = (S16___0 )0;
#line 4382
        sd10->rgb[2] = (S16___0 )0;
#line 4383
        sd10->light = (U16___1 )0;
#line 4384
        sd10->mode_state = (U8___1 volatile   )mode11;
#line 4385
        colorsensor_init(port_id9, 136);
#line 4386
        colorsensor_init(port_id9, (int )((unsigned char )NXT_COLORSENSOR_PROTOCOLS[mode11]));
      }
#line 4388
      if ((int )mode11 == 0) {
#line 4389
        tmp12 = colorsensor_color_get(port_id9);
#line 4390
        sd10->color = (U16___1 )tmp12;
#line 4391
        colorsensor_rgb_get(port_id9, sd10->rgb);
      } else {
#line 4393
        tmp___013 = colorsensor_light_get(port_id9);
#line 4394
        sd10->light = (U16___1 )tmp___013;
#line 4395
        if ((int )mode11 == 4) {
#line 4396
          colorsensor_light_full(port_id9);
        }
      }
    }
#line 4400
    port_id9 ++;
  }
#line 4402
  goto Lret_ecrobot_process_bg_nxtcolorsensor;
  Lret_ecrobot_process_bg_nxtcolorsensor: 
#line 4404
  port_id7 = (U8___3 )0;
#line 4405
  ret_ecrobot_get_nxtcolorsensor_light8 = sensor_data[port_id7].light;
#line 4406
  goto Lret_ecrobot_get_nxtcolorsensor_light;
  Lret_ecrobot_get_nxtcolorsensor_light: 
#line 4408
  tmp = ret_ecrobot_get_nxtcolorsensor_light8;
#line 4409
  color = tmp;
#line 4410
  if ((int )color < 300) {
#line 4411
    GetResource(DrivingControlResource);
#line 4412
    priority3 = 50;
#line 4413
    speed_left4 = -100;
#line 4414
    speed_right5 = -100;
#line 4415
    duration6 = 1250;
#line 4416
    GetResource(DrivingControlResource);
#line 4417
    if (dc.priority != 20) {
#line 4418
      SeekStarted = (U32___4 )0;
    }
#line 4420
    if (priority3 >= dc.priority) {
#line 4421
      dc.priority = priority3;
#line 4422
      dc.speed_left = (S32___1 )speed_left4;
#line 4423
      dc.speed_right = (S32___1 )speed_right5;
#line 4424
      dc.duration = (U32___4 )duration6;
    }
#line 4426
    ReleaseResource(DrivingControlResource);
#line 4427
    goto Lret_change_driving_command;
    Lret_change_driving_command: 
#line 4429
    ReleaseResource(DrivingControlResource);
  }
#line 4431
  TerminateTask();
#line 4432
  return;
}
}
#line 4435
extern int copysign() ;
#line 4523
extern int ( /* missing proto */  memset)() ;
#line 4436 "sumo/sumo.c"
void TaskMainSonarSensorTask(void) 
{ 
  int duration ;
  S32___1 distance ;
  S32___1 tmp ;
  int seek_delay_1 ;
  int seek_delay_2 ;
  int seek_delay_3 ;
  int seek_delay_4 ;
  int speed_left ;
  int speed_right ;
  int modifier ;
  int tmp___0 ;
  int tmp___1 ;
  U32___4 current_sys_tick ;
  U32___4 tmp___2 ;
  U32___4 delta ;
  int priority16 ;
  int speed_left17 ;
  int speed_right18 ;
  int duration19 ;
  int priority20 ;
  int speed_left21 ;
  int speed_right22 ;
  int duration23 ;
  int priority24 ;
  int speed_left25 ;
  int speed_right26 ;
  int duration27 ;
  int priority28 ;
  int speed_left29 ;
  int speed_right30 ;
  int duration31 ;
  int priority32 ;
  int speed_left33 ;
  int speed_right34 ;
  int duration35 ;
  int priority36 ;
  int speed_left37 ;
  int speed_right38 ;
  int duration39 ;
  U8___1 port_id40 ;
  int tmp41 ;
  long ret_ecrobot_get_sonar_sensor42 ;
  int port43 ;
  U32___0 address44 ;
  int internal_address45 ;
  int n_internal_address_bytes46 ;
  U8___0 *data47 ;
  U32___0 nbytes48 ;
  int write49 ;
  struct i2c_port_struct *p50 ;
  struct i2c_partial_transaction *pt51 ;
  int tmp52 ;
  int tmp___053 ;

  {
#line 4493
  if (InSetupPhase) {
#line 4494
    TerminateTask();
  }
#line 4496
  duration = 3000;
#line 4497
  port_id40 = (U8___3 )1;
#line 4498
  tmp41 = i2c_busy((int )port_id40);
#line 4499
  if (tmp41 == 0) {
#line 4501
    port43 = (int )port_id40;
#line 4502
    address44 = (U32___1 )1;
#line 4503
    internal_address45 = 66;
#line 4504
    n_internal_address_bytes46 = 1;
#line 4506
    nbytes48 = (U32___1 )1;
#line 4507
    write49 = 0;
#line 4508
    if (port43 < 0) {
#line 4509
      goto Lret_i2c_start_transaction;
    } else
#line 4511
    if (port43 >= 4) {
#line 4512
      goto Lret_i2c_start_transaction;
    }
#line 4514
    tmp52 = i2c_busy(port43);
#line 4515
    if (tmp52) {
#line 4516
      goto Lret_i2c_start_transaction;
    }
#line 4518
    p50 = & i2c_port[port43];
#line 4519
    p50->pt_num = (U32___0 )0;
#line 4520
    p50->pt_begun = (U32___0 )0;
#line 4521
    pt51 = p50->partial_transaction;
#line 4522
    p50->current_pt = pt51;
#line 4523
    memset((void *)pt51, 0, sizeof(p50->partial_transaction));
#line 4524
    if (n_internal_address_bytes46 > 0) {
#line 4525
      p50->addr_int[0] = (U8___0 )(address44 << 1);
#line 4526
      p50->addr_int[1] = (U8___0 )internal_address45;
#line 4527
      pt51->start = (U8___0 )1;
#line 4528
      if (write49) {
#line 4529
        pt51->stop = (U8___0 )0;
      } else {
#line 4531
        pt51->stop = (U8___0 )1;
      }
#line 4533
      pt51->tx = (U8___0 )1;
#line 4534
      pt51->data = p50->addr_int;
#line 4535
      pt51->nbytes = (U16___0 )2;
#line 4536
      pt51 ++;
    }
#line 4538
    if (n_internal_address_bytes46 == 0) {
#line 4539
      goto _L___2;
    } else
#line 4541
    if (! write49) {
      _L___2: 
#line 4543
      if (n_internal_address_bytes46 > 0) {
#line 4544
        pt51->start = (U8___0 )0;
      } else {
#line 4546
        pt51->start = (U8___0 )1;
      }
#line 4548
      pt51->restart = (U8___0 )(! pt51->start);
#line 4549
      pt51->stop = (U8___0 )0;
#line 4550
      pt51->tx = (U8___0 )1;
#line 4551
      if (write49) {
#line 4552
        tmp___053 = 0;
      } else {
#line 4554
        tmp___053 = 1;
      }
#line 4556
      p50->addr = (U8___0 )((address44 << 1) | (unsigned long )tmp___053);
#line 4557
      pt51->data = & p50->addr;
#line 4558
      pt51->nbytes = (U16___0 )1;
#line 4559
      pt51 ++;
    }
#line 4561
    pt51->start = (U8___0 )0;
#line 4562
    pt51->stop = (U8___0 )1;
#line 4563
    if (write49) {
#line 4564
      pt51->tx = (U8___0 )1;
    } else {
#line 4566
      pt51->tx = (U8___0 )0;
    }
#line 4568
    pt51->data = data47;
#line 4569
    pt51->nbytes = (U16___0 )nbytes48;
#line 4570
    pt51->last_pt = (U8___0 )1;
#line 4571
    p50->state = (i2c_port_state )2;
#line 4572
    goto Lret_i2c_start_transaction;
    Lret_i2c_start_transaction: ;
  }
#line 4575
  ret_ecrobot_get_sonar_sensor42 = distance_state[port_id40];
#line 4576
  goto Lret_ecrobot_get_sonar_sensor;
  Lret_ecrobot_get_sonar_sensor: 
#line 4578
  tmp = ret_ecrobot_get_sonar_sensor42;
#line 4579
  distance = tmp;
#line 4580
  if (LastSonarValue == 0L) {
#line 4581
    LastSonarValue = (S32___1 )255;
  }
#line 4583
  if (distance == 255L) {
#line 4584
    if (LastSonarValue < 20L) {
#line 4585
      priority16 = 30;
#line 4586
      speed_left17 = 100;
#line 4587
      speed_right18 = 100;
#line 4588
      duration19 = 150;
#line 4589
      GetResource(DrivingControlResource);
#line 4590
      if (dc.priority != 20) {
#line 4591
        SeekStarted = (U32___4 )0;
      }
#line 4593
      if (priority16 >= dc.priority) {
#line 4594
        dc.priority = priority16;
#line 4595
        dc.speed_left = (S32___1 )speed_left17;
#line 4596
        dc.speed_right = (S32___1 )speed_right18;
#line 4597
        dc.duration = (U32___4 )duration19;
      }
#line 4599
      ReleaseResource(DrivingControlResource);
#line 4600
      goto Lret_change_driving_command;
      Lret_change_driving_command: ;
    } else {
#line 4603
      LastSonarValue = distance;
    }
  } else {
#line 4606
    LastSonarValue = distance;
  }
#line 4608
  seek_delay_1 = 1000;
#line 4609
  seek_delay_2 = seek_delay_1 * 2;
#line 4610
  seek_delay_3 = seek_delay_2 * 2;
#line 4611
  seek_delay_4 = seek_delay_3 + 2000;
#line 4612
  if (distance > 70L) {
#line 4613
    if (SeekStarted == 0UL) {
#line 4614
      SeekStarted = systick_get_ms();
#line 4615
      tmp___0 = rand();
#line 4616
      tmp___1 = copysign(1, tmp___0 - 1073741823);
#line 4617
      modifier = tmp___1;
#line 4618
      speed_left = -70 * modifier;
#line 4619
      speed_right = 70 * modifier;
#line 4620
      priority20 = 20;
#line 4621
      speed_left21 = speed_left;
#line 4622
      speed_right22 = speed_right;
#line 4623
      duration23 = duration;
#line 4624
      GetResource(DrivingControlResource);
#line 4625
      if (dc.priority != 20) {
#line 4626
        SeekStarted = (U32___4 )0;
      }
#line 4628
      if (priority20 >= dc.priority) {
#line 4629
        dc.priority = priority20;
#line 4630
        dc.speed_left = (S32___1 )speed_left21;
#line 4631
        dc.speed_right = (S32___1 )speed_right22;
#line 4632
        dc.duration = (U32___4 )duration23;
      }
#line 4634
      ReleaseResource(DrivingControlResource);
#line 4635
      goto Lret_change_driving_command___0;
      Lret_change_driving_command___0: ;
    } else {
#line 4638
      tmp___2 = systick_get_ms();
#line 4639
      current_sys_tick = tmp___2;
#line 4640
      delta = current_sys_tick - SeekStarted;
#line 4641
      if (delta > (U32___4 )seek_delay_1) {
#line 4642
        if (delta <= (U32___4 )(seek_delay_1 + 100)) {
#line 4643
          GetResource(DrivingControlResource);
#line 4644
          speed_left = (int )(dc.speed_left * -1L);
#line 4645
          speed_right = (int )(dc.speed_right * -1L);
#line 4646
          ReleaseResource(DrivingControlResource);
#line 4647
          priority24 = 20;
#line 4648
          speed_left25 = speed_left;
#line 4649
          speed_right26 = speed_right;
#line 4650
          duration27 = duration;
#line 4651
          GetResource(DrivingControlResource);
#line 4652
          if (dc.priority != 20) {
#line 4653
            SeekStarted = (U32___4 )0;
          }
#line 4655
          if (priority24 >= dc.priority) {
#line 4656
            dc.priority = priority24;
#line 4657
            dc.speed_left = (S32___1 )speed_left25;
#line 4658
            dc.speed_right = (S32___1 )speed_right26;
#line 4659
            dc.duration = (U32___4 )duration27;
          }
#line 4661
          ReleaseResource(DrivingControlResource);
#line 4662
          goto Lret_change_driving_command___1;
          Lret_change_driving_command___1: ;
        } else {
#line 4665
          goto _L___1;
        }
      } else
      _L___1: 
#line 4669
      if (delta > (U32___4 )seek_delay_2) {
#line 4670
        if (delta <= (U32___4 )(seek_delay_2 + 100)) {
#line 4671
          GetResource(DrivingControlResource);
#line 4672
          speed_left = (int )(dc.speed_left * -1L);
#line 4673
          speed_right = (int )(dc.speed_right * -1L);
#line 4674
          ReleaseResource(DrivingControlResource);
#line 4675
          priority28 = 20;
#line 4676
          speed_left29 = speed_left;
#line 4677
          speed_right30 = speed_right;
#line 4678
          duration31 = duration;
#line 4679
          GetResource(DrivingControlResource);
#line 4680
          if (dc.priority != 20) {
#line 4681
            SeekStarted = (U32___4 )0;
          }
#line 4683
          if (priority28 >= dc.priority) {
#line 4684
            dc.priority = priority28;
#line 4685
            dc.speed_left = (S32___1 )speed_left29;
#line 4686
            dc.speed_right = (S32___1 )speed_right30;
#line 4687
            dc.duration = (U32___4 )duration31;
          }
#line 4689
          ReleaseResource(DrivingControlResource);
#line 4690
          goto Lret_change_driving_command___2;
          Lret_change_driving_command___2: ;
        } else {
#line 4693
          goto _L___0;
        }
      } else
      _L___0: 
#line 4697
      if (delta > (U32___4 )seek_delay_3) {
#line 4698
        if (delta <= (U32___4 )seek_delay_4) {
#line 4699
          speed_left = 100;
#line 4700
          speed_right = 100;
#line 4701
          priority32 = 20;
#line 4702
          speed_left33 = speed_left;
#line 4703
          speed_right34 = speed_right;
#line 4704
          duration35 = duration;
#line 4705
          GetResource(DrivingControlResource);
#line 4706
          if (dc.priority != 20) {
#line 4707
            SeekStarted = (U32___4 )0;
          }
#line 4709
          if (priority32 >= dc.priority) {
#line 4710
            dc.priority = priority32;
#line 4711
            dc.speed_left = (S32___1 )speed_left33;
#line 4712
            dc.speed_right = (S32___1 )speed_right34;
#line 4713
            dc.duration = (U32___4 )duration35;
          }
#line 4715
          ReleaseResource(DrivingControlResource);
#line 4716
          goto Lret_change_driving_command___3;
          Lret_change_driving_command___3: ;
        } else {
#line 4719
          goto _L;
        }
      } else
      _L: 
#line 4723
      if (delta > (U32___4 )seek_delay_4) {
#line 4724
        SeekStarted = (U32___4 )0;
      }
    }
  } else {
#line 4728
    priority36 = 30;
#line 4729
    speed_left37 = 100;
#line 4730
    speed_right38 = 100;
#line 4731
    duration39 = 150;
#line 4732
    GetResource(DrivingControlResource);
#line 4733
    if (dc.priority != 20) {
#line 4734
      SeekStarted = (U32___4 )0;
    }
#line 4736
    if (priority36 >= dc.priority) {
#line 4737
      dc.priority = priority36;
#line 4738
      dc.speed_left = (S32___1 )speed_left37;
#line 4739
      dc.speed_right = (S32___1 )speed_right38;
#line 4740
      dc.duration = (U32___4 )duration39;
    }
#line 4742
    ReleaseResource(DrivingControlResource);
#line 4743
    goto Lret_change_driving_command___4;
    Lret_change_driving_command___4: ;
  }
#line 4746
  TerminateTask();
#line 4747
  return;
}
}
#line 4934
extern int ( /* missing proto */  display_unsigned_worker)() ;
#line 4750 "sumo/sumo.c"
void TaskMainDisplayTask(void) 
{ 
  U32___4 tmp ;
  U16___3 color ;
  U16___3 tmp___0 ;
  S32___1 sonar ;
  S32___1 tmp___1 ;
  U8___1 port_id6 ;
  int tmp7 ;
  long ret_ecrobot_get_sonar_sensor8 ;
  U8___1 port_id9 ;
  unsigned short ret_ecrobot_get_nxtcolorsensor_light10 ;
  int port11 ;
  U32___0 address12 ;
  int internal_address13 ;
  int n_internal_address_bytes14 ;
  U8___0 *data15 ;
  U32___0 nbytes16 ;
  int write17 ;
  struct i2c_port_struct *p18 ;
  struct i2c_partial_transaction *pt19 ;
  int tmp20 ;
  int tmp___021 ;
  int x22 ;
  int y23 ;
  int x24 ;
  int y25 ;
  int x26 ;
  int y27 ;
  int x28 ;
  int y29 ;
  int x30 ;
  int y31 ;
  int x32 ;
  int y33 ;
  int x34 ;
  int y35 ;
  char const   *str36 ;
  char const   *str37 ;
  char const   *str38 ;
  char const   *str39 ;
  char const   *str40 ;
  char const   *str41 ;
  char const   *str42 ;
  char const   *str43 ;
  char const   *str44 ;
  char const   *str45 ;
  char const   *str46 ;
  char const   *str47 ;
  char const   *str48 ;
  int val49 ;
  U32 places50 ;
  int tmp51 ;
  int val52 ;
  U32 places53 ;
  int tmp54 ;
  int val55 ;
  U32 places56 ;
  int tmp57 ;
  int val58 ;
  U32 places59 ;
  int tmp60 ;
  int val61 ;
  U32 places62 ;
  int tmp63 ;
  int val64 ;
  U32 places65 ;
  int tmp66 ;
  int val67 ;
  U32 places68 ;
  int tmp69 ;
  int val70 ;
  U32 places71 ;
  int tmp72 ;

  {
#line 4826
  if (InSetupPhase) {
#line 4827
    TerminateTask();
  }
#line 4829
  display_clear((U32___4 )0);
#line 4830
  GetResource(DrivingControlResource);
#line 4831
  x22 = 0;
#line 4832
  y23 = 0;
#line 4833
  display_x = x22;
#line 4834
  display_y = y23;
#line 4835
  goto Lret_display_goto_xy;
  Lret_display_goto_xy: 
#line 4837
  str36 = "PRIO: ";
#line 4838
  while (*str36) {
#line 4839
    if ((int const   )*str36 != 10) {
#line 4840
      display_char((int )*str36);
#line 4841
      display_x ++;
    } else {
#line 4843
      display_x = 0;
#line 4844
      display_y ++;
    }
#line 4846
    str36 ++;
  }
#line 4848
  goto Lret_display_string;
  Lret_display_string: ;
#line 4850
  switch (dc.priority) {
  case 5: 
#line 4852
  str37 = "IDLE";
#line 4853
  while (*str37) {
#line 4854
    if ((int const   )*str37 != 10) {
#line 4855
      display_char((int )*str37);
#line 4856
      display_x ++;
    } else {
#line 4858
      display_x = 0;
#line 4859
      display_y ++;
    }
#line 4861
    str37 ++;
  }
#line 4863
  goto Lret_display_string___0;
  Lret_display_string___0: ;
#line 4865
  break;
  case 20: 
#line 4867
  str38 = "SEEK";
#line 4868
  while (*str38) {
#line 4869
    if ((int const   )*str38 != 10) {
#line 4870
      display_char((int )*str38);
#line 4871
      display_x ++;
    } else {
#line 4873
      display_x = 0;
#line 4874
      display_y ++;
    }
#line 4876
    str38 ++;
  }
#line 4878
  goto Lret_display_string___1;
  Lret_display_string___1: ;
#line 4880
  break;
  case 30: 
#line 4882
  str39 = "FOLLOW";
#line 4883
  while (*str39) {
#line 4884
    if ((int const   )*str39 != 10) {
#line 4885
      display_char((int )*str39);
#line 4886
      display_x ++;
    } else {
#line 4888
      display_x = 0;
#line 4889
      display_y ++;
    }
#line 4891
    str39 ++;
  }
#line 4893
  goto Lret_display_string___2;
  Lret_display_string___2: ;
#line 4895
  break;
  case 50: 
#line 4897
  str40 = "COLOR";
#line 4898
  while (*str40) {
#line 4899
    if ((int const   )*str40 != 10) {
#line 4900
      display_char((int )*str40);
#line 4901
      display_x ++;
    } else {
#line 4903
      display_x = 0;
#line 4904
      display_y ++;
    }
#line 4906
    str40 ++;
  }
#line 4908
  goto Lret_display_string___3;
  Lret_display_string___3: ;
#line 4910
  break;
  default: 
#line 4912
  str41 = "WTF: ";
#line 4913
  while (*str41) {
#line 4914
    if ((int const   )*str41 != 10) {
#line 4915
      display_char((int )*str41);
#line 4916
      display_x ++;
    } else {
#line 4918
      display_x = 0;
#line 4919
      display_y ++;
    }
#line 4921
    str41 ++;
  }
#line 4923
  goto Lret_display_string___4;
  Lret_display_string___4: 
#line 4926
  val49 = dc.priority;
#line 4927
  places50 = (U32___4 )3;
#line 4929
  if (val49 < 0) {
#line 4930
    tmp51 = - val49;
  } else {
#line 4932
    tmp51 = val49;
  }
#line 4934
  display_unsigned_worker((U32 )tmp51, places50, (U32 )(val49 < 0));
#line 4935
  goto Lret_display_int;
  Lret_display_int: ;
#line 4939
  break;
  }
#line 4941
  x24 = 0;
#line 4942
  y25 = 1;
#line 4943
  display_x = x24;
#line 4944
  display_y = y25;
#line 4945
  goto Lret_display_goto_xy___0;
  Lret_display_goto_xy___0: 
#line 4947
  str42 = "SPEED L/R: ";
#line 4948
  while (*str42) {
#line 4949
    if ((int const   )*str42 != 10) {
#line 4950
      display_char((int )*str42);
#line 4951
      display_x ++;
    } else {
#line 4953
      display_x = 0;
#line 4954
      display_y ++;
    }
#line 4956
    str42 ++;
  }
#line 4958
  goto Lret_display_string___5;
  Lret_display_string___5: 
#line 4960
  x26 = 0;
#line 4961
  y27 = 2;
#line 4962
  display_x = x26;
#line 4963
  display_y = y27;
#line 4964
  goto Lret_display_goto_xy___1;
  Lret_display_goto_xy___1: 
#line 4967
  val52 = (int )dc.speed_left;
#line 4968
  places53 = (U32___4 )4;
#line 4970
  if (val52 < 0) {
#line 4971
    tmp54 = - val52;
  } else {
#line 4973
    tmp54 = val52;
  }
#line 4975
  display_unsigned_worker((U32 )tmp54, places53, (U32 )(val52 < 0));
#line 4976
  goto Lret_display_int___0;
  Lret_display_int___0: 
#line 4979
  str43 = "/";
#line 4981
  while (*str43) {
#line 4982
    if ((int const   )*str43 != 10) {
#line 4983
      display_char((int )*str43);
#line 4984
      display_x ++;
    } else {
#line 4986
      display_x = 0;
#line 4987
      display_y ++;
    }
#line 4989
    str43 ++;
  }
#line 4991
  goto Lret_display_string___6;
  Lret_display_string___6: 
#line 4994
  val55 = (int )dc.speed_right;
#line 4995
  places56 = (U32___4 )4;
#line 4997
  if (val55 < 0) {
#line 4998
    tmp57 = - val55;
  } else {
#line 5000
    tmp57 = val55;
  }
#line 5002
  display_unsigned_worker((U32 )tmp57, places56, (U32 )(val55 < 0));
#line 5003
  goto Lret_display_int___1;
  Lret_display_int___1: 
#line 5006
  x28 = 0;
#line 5007
  y29 = 3;
#line 5008
  display_x = x28;
#line 5009
  display_y = y29;
#line 5011
  goto Lret_display_goto_xy___2;
  Lret_display_goto_xy___2: 
#line 5013
  str44 = "DURATION: ";
#line 5014
  while (*str44) {
#line 5015
    if ((int const   )*str44 != 10) {
#line 5016
      display_char((int )*str44);
#line 5017
      display_x ++;
    } else {
#line 5019
      display_x = 0;
#line 5020
      display_y ++;
    }
#line 5022
    str44 ++;
  }
#line 5024
  goto Lret_display_string___7;
  Lret_display_string___7: 
#line 5027
  val58 = (int )dc.duration;
#line 5028
  places59 = (U32___4 )0;
#line 5030
  if (val58 < 0) {
#line 5031
    tmp60 = - val58;
  } else {
#line 5033
    tmp60 = val58;
  }
#line 5035
  display_unsigned_worker((U32 )tmp60, places59, (U32 )(val58 < 0));
#line 5036
  goto Lret_display_int___2;
  Lret_display_int___2: 
#line 5039
  ReleaseResource(DrivingControlResource);
#line 5040
  x30 = 0;
#line 5041
  y31 = 4;
#line 5042
  display_x = x30;
#line 5043
  display_y = y31;
#line 5045
  goto Lret_display_goto_xy___3;
  Lret_display_goto_xy___3: 
#line 5047
  str45 = "SYSTEM: ";
#line 5048
  while (*str45) {
#line 5049
    if ((int const   )*str45 != 10) {
#line 5050
      display_char((int )*str45);
#line 5051
      display_x ++;
    } else {
#line 5053
      display_x = 0;
#line 5054
      display_y ++;
    }
#line 5056
    str45 ++;
  }
#line 5058
  goto Lret_display_string___8;
  Lret_display_string___8: 
#line 5061
  tmp = systick_get_ms();
#line 5062
  val61 = (int )tmp;
#line 5063
  places62 = (U32___4 )0;
#line 5065
  if (val61 < 0) {
#line 5066
    tmp63 = - val61;
  } else {
#line 5068
    tmp63 = val61;
  }
#line 5070
  display_unsigned_worker((U32 )tmp63, places62, (U32 )(val61 < 0));
#line 5071
  goto Lret_display_int___3;
  Lret_display_int___3: 
#line 5074
  port_id9 = (U8___3 )0;
#line 5075
  ret_ecrobot_get_nxtcolorsensor_light10 = sensor_data[port_id9].light;
#line 5077
  goto Lret_ecrobot_get_nxtcolorsensor_light;
  Lret_ecrobot_get_nxtcolorsensor_light: 
#line 5079
  tmp___0 = ret_ecrobot_get_nxtcolorsensor_light10;
#line 5080
  color = tmp___0;
#line 5081
  x32 = 0;
#line 5082
  y33 = 5;
#line 5083
  display_x = x32;
#line 5084
  display_y = y33;
#line 5085
  goto Lret_display_goto_xy___4;
  Lret_display_goto_xy___4: 
#line 5087
  str46 = "COLOR: ";
#line 5088
  while (*str46) {
#line 5089
    if ((int const   )*str46 != 10) {
#line 5090
      display_char((int )*str46);
#line 5091
      display_x ++;
    } else {
#line 5093
      display_x = 0;
#line 5094
      display_y ++;
    }
#line 5096
    str46 ++;
  }
#line 5098
  goto Lret_display_string___9;
  Lret_display_string___9: 
#line 5101
  val64 = (int )color;
#line 5102
  places65 = (U32___4 )0;
#line 5104
  if (val64 < 0) {
#line 5105
    tmp66 = - val64;
  } else {
#line 5107
    tmp66 = val64;
  }
#line 5109
  display_unsigned_worker((U32 )tmp66, places65, (U32 )(val64 < 0));
#line 5110
  goto Lret_display_int___4;
  Lret_display_int___4: 
#line 5113
  port_id6 = (U8___3 )1;
#line 5114
  tmp7 = i2c_busy((int )port_id6);
#line 5116
  if (tmp7 == 0) {
#line 5118
    port11 = (int )port_id6;
#line 5119
    address12 = (U32___1 )1;
#line 5120
    internal_address13 = 66;
#line 5121
    n_internal_address_bytes14 = 1;
#line 5123
    nbytes16 = (U32___1 )1;
#line 5124
    write17 = 0;
#line 5125
    if (port11 < 0) {
#line 5126
      goto Lret_i2c_start_transaction;
    } else
#line 5128
    if (port11 >= 4) {
#line 5129
      goto Lret_i2c_start_transaction;
    }
#line 5131
    tmp20 = i2c_busy(port11);
#line 5132
    if (tmp20) {
#line 5133
      goto Lret_i2c_start_transaction;
    }
#line 5135
    p18 = & i2c_port[port11];
#line 5136
    p18->pt_num = (U32___0 )0;
#line 5137
    p18->pt_begun = (U32___0 )0;
#line 5138
    pt19 = p18->partial_transaction;
#line 5139
    p18->current_pt = pt19;
#line 5140
    memset((void *)pt19, 0, sizeof(p18->partial_transaction));
#line 5141
    if (n_internal_address_bytes14 > 0) {
#line 5142
      p18->addr_int[0] = (U8___0 )(address12 << 1);
#line 5143
      p18->addr_int[1] = (U8___0 )internal_address13;
#line 5144
      pt19->start = (U8___0 )1;
#line 5145
      if (write17) {
#line 5146
        pt19->stop = (U8___0 )0;
      } else {
#line 5148
        pt19->stop = (U8___0 )1;
      }
#line 5150
      pt19->tx = (U8___0 )1;
#line 5151
      pt19->data = p18->addr_int;
#line 5152
      pt19->nbytes = (U16___0 )2;
#line 5153
      pt19 ++;
    }
#line 5155
    if (n_internal_address_bytes14 == 0) {
#line 5156
      goto _L;
    } else
#line 5158
    if (! write17) {
      _L: 
#line 5160
      if (n_internal_address_bytes14 > 0) {
#line 5161
        pt19->start = (U8___0 )0;
      } else {
#line 5163
        pt19->start = (U8___0 )1;
      }
#line 5165
      pt19->restart = (U8___0 )(! pt19->start);
#line 5166
      pt19->stop = (U8___0 )0;
#line 5167
      pt19->tx = (U8___0 )1;
#line 5168
      if (write17) {
#line 5169
        tmp___021 = 0;
      } else {
#line 5171
        tmp___021 = 1;
      }
#line 5173
      p18->addr = (U8___0 )((address12 << 1) | (unsigned long )tmp___021);
#line 5174
      pt19->data = & p18->addr;
#line 5175
      pt19->nbytes = (U16___0 )1;
#line 5176
      pt19 ++;
    }
#line 5178
    pt19->start = (U8___0 )0;
#line 5179
    pt19->stop = (U8___0 )1;
#line 5180
    if (write17) {
#line 5181
      pt19->tx = (U8___0 )1;
    } else {
#line 5183
      pt19->tx = (U8___0 )0;
    }
#line 5185
    pt19->data = data15;
#line 5186
    pt19->nbytes = (U16___0 )nbytes16;
#line 5187
    pt19->last_pt = (U8___0 )1;
#line 5188
    p18->state = (i2c_port_state )2;
#line 5189
    goto Lret_i2c_start_transaction;
    Lret_i2c_start_transaction: ;
  }
#line 5192
  ret_ecrobot_get_sonar_sensor8 = distance_state[port_id6];
#line 5193
  goto Lret_ecrobot_get_sonar_sensor;
  Lret_ecrobot_get_sonar_sensor: 
#line 5195
  tmp___1 = ret_ecrobot_get_sonar_sensor8;
#line 5196
  sonar = tmp___1;
#line 5197
  x34 = 0;
#line 5198
  y35 = 6;
#line 5199
  display_x = x34;
#line 5200
  display_y = y35;
#line 5201
  goto Lret_display_goto_xy___5;
  Lret_display_goto_xy___5: 
#line 5203
  str47 = "SONAR: ";
#line 5204
  while (*str47) {
#line 5205
    if ((int const   )*str47 != 10) {
#line 5206
      display_char((int )*str47);
#line 5207
      display_x ++;
    } else {
#line 5209
      display_x = 0;
#line 5210
      display_y ++;
    }
#line 5212
    str47 ++;
  }
#line 5214
  goto Lret_display_string___10;
  Lret_display_string___10: 
#line 5217
  val67 = (int )sonar;
#line 5218
  places68 = (U32___4 )0;
#line 5220
  if (val67 < 0) {
#line 5221
    tmp69 = - val67;
  } else {
#line 5223
    tmp69 = val67;
  }
#line 5225
  display_unsigned_worker((U32 )tmp69, places68, (U32 )(val67 < 0));
#line 5226
  goto Lret_display_int___5;
  Lret_display_int___5: 
#line 5229
  str48 = " / ";
#line 5231
  while (*str48) {
#line 5232
    if ((int const   )*str48 != 10) {
#line 5233
      display_char((int )*str48);
#line 5234
      display_x ++;
    } else {
#line 5236
      display_x = 0;
#line 5237
      display_y ++;
    }
#line 5239
    str48 ++;
  }
#line 5241
  goto Lret_display_string___11;
  Lret_display_string___11: 
#line 5244
  val70 = (int )LastSonarValue;
#line 5245
  places71 = (U32___4 )0;
#line 5247
  if (val70 < 0) {
#line 5248
    tmp72 = - val70;
  } else {
#line 5250
    tmp72 = val70;
  }
#line 5252
  display_unsigned_worker((U32 )tmp72, places71, (U32 )(val70 < 0));
#line 5253
  goto Lret_display_int___6;
  Lret_display_int___6: 
#line 5256
  display_update();
#line 5257
  TerminateTask();
#line 5259
  return;
}
}
#line 5262
extern int create_block() ;
#line 5263
extern int create_task() ;
#line 5264 "sumo/sumo.c"
void main(void) 
{ 


  {
#line 5268
  create_task("TaskMainDisplayTask", "TaskMainDisplayTask", 10, 250, 0.411);
#line 5269
  create_task("TaskMainColorSensorTask", "TaskMainColorSensorTask", 2, 100, 0.068);
#line 5270
  create_task("TaskMainSonarSensorTask", "TaskMainSonarSensorTask", 5, 100, 0.114);
#line 5271
  create_task("TaskMainMotorControlTask", "TaskMainMotorControlTask", 1, 50, 0.074);
#line 5272
  create_block(4280, "TaskMainMotorControlTask", "DrivingControlResource", 1, 1, 0.071);
#line 5273
  create_block(4411, "TaskMainColorSensorTask", "DrivingControlResource", 2, 2, 0.028);
#line 5274
  create_block(4416, "TaskMainColorSensorTask", "DrivingControlResource", 2, 2, 0.02);
#line 5275
  create_block(4830, "TaskMainDisplayTask", "DrivingControlResource", 1, 10, 0.22);
#line 5276
  create_block(4589, "TaskMainSonarSensorTask", "DrivingControlResource", 8, 5, 0.019);
#line 5277
  create_block(4624, "TaskMainSonarSensorTask", "DrivingControlResource", 8, 5, 0.018);
#line 5278
  create_block(4643, "TaskMainSonarSensorTask", "DrivingControlResource", 8, 5, 0.01);
#line 5279
  create_block(4651, "TaskMainSonarSensorTask", "DrivingControlResource", 8, 5, 0.018);
#line 5280
  create_block(4671, "TaskMainSonarSensorTask", "DrivingControlResource", 8, 5, 0.012);
#line 5281
  create_block(4679, "TaskMainSonarSensorTask", "DrivingControlResource", 8, 5, 0.019);
#line 5282
  create_block(4705, "TaskMainSonarSensorTask", "DrivingControlResource", 8, 5, 0.022);
#line 5283
  create_block(4732, "TaskMainSonarSensorTask", "DrivingControlResource", 8, 5, 0.019);
#line 5284
  return;
}
}
