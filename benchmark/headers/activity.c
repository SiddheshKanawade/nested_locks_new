#include <activity.h>
#include <po_hi_gqueue.h>
#include <deployment.h>
#include <po_hi_types.h>
#include <request.h>
#include <types.h>
#include "subprograms.h"
#include <po_hi_transport.h>
#include <po_hi_task.h>
#include <po_hi_main.h>
/**************************************************** */
/*  This file was automatically generated by Ocarina  */
/*  Working Copy from rd2e9f13e */
/*  Do NOT hand-modify this file, as your             */
/*  changes will be lost when you re-run Ocarina      */
/**************************************************** */
void __po_hi_main_initialize (void);
__po_hi_port_t __po_hi_prs_gps_gps_pos_local_destinations[1] = {prs_mgmt_global_gps_pos};
__po_hi_port_id_t __po_hi_prs_gps_woffsets[__po_hi_prs_gps_nb_ports];
__po_hi_port_id_t __po_hi_prs_gps_offsets[__po_hi_prs_gps_nb_ports];
__po_hi_port_id_t __po_hi_prs_gps_used_size[__po_hi_prs_gps_nb_ports];
__po_hi_port_id_t __po_hi_prs_gps_empties[__po_hi_prs_gps_nb_ports];
__po_hi_port_id_t __po_hi_prs_gps_first[__po_hi_prs_gps_nb_ports];
__po_hi_request_t *__po_hi_prs_gps_recent[__po_hi_prs_gps_nb_ports];
__po_hi_request_t *__po_hi_prs_gps_queue[0];
__po_hi_uint16_t __po_hi_prs_gps_total_fifo_size = 0;
__po_hi_local_port_t __po_hi_prs_gps_history[0];
__po_hi_port_id_t __po_hi_prs_gps_n_dest[__po_hi_prs_gps_nb_ports] = {1};
__po_hi_port_id_t __po_hi_prs_gps_fifo_size[__po_hi_prs_gps_nb_ports] = {__PO_HI_GQUEUE_FIFO_OUT};
__po_hi_port_t* __po_hi_prs_gps_destinations[__po_hi_prs_gps_nb_ports] = {__po_hi_prs_gps_gps_pos_local_destinations};

/*!
 * \fn void* prs_gps_job (void)
 * \brief Function executed by the task prs_gps
 *
 * This function is executed as soon as the task  is created. It performs the 
 * following operations:  Receive incoming data,  Execute tasks subprograms,  
 * Send output data.
 */
/*  Periodic task : prs_gps */
void* prs_gps_job (void)
{
  static ardupilot_software__gps_position_i gps_pos_request_var;
  __po_hi_request_t *gps_pos_request;
  __po_hi_int32_t error;

  
/*!
 * Waiting for other tasks initialization
 */
  __po_hi_wait_initialization ();
  __po_hi_compute_next_period (process_ardupilot_prs_gps_k);
  
/*!
 * Waiting for the first dispatch instant
 */
  __po_hi_wait_for_next_period (process_ardupilot_prs_gps_k);
  
/*!
 * Task body
 */
  while (1)
  {
    /*  Call implementation */
    ardupilot_software__spg_gps_simulation (&(gps_pos_request_var));
    /*  Set the OUT port values */
    gps_pos_request =
     __po_hi_get_request ();
    gps_pos_request->vars.prs_gps_global_gps_pos.prs_gps_global_gps_pos = gps_pos_request_var;
    gps_pos_request->port = prs_gps_global_gps_pos;
    __po_hi_gqueue_store_out (process_ardupilot_prs_gps_k, prs_gps_local_gps_pos, gps_pos_request);
    /*  Send the OUT ports */
    error =
     __po_hi_send_output (process_ardupilot_prs_gps_k, prs_gps_global_gps_pos);
    (void)error;
    __po_hi_wait_for_next_period (process_ardupilot_prs_gps_k);
  }
}

__po_hi_port_t __po_hi_prs_mgmt_speed_local_destinations[1] = {prs_throttle_global_speed};
__po_hi_port_t __po_hi_prs_mgmt_angle_local_destinations[1] = {prs_yaw_global_angle};
__po_hi_port_id_t __po_hi_prs_mgmt_woffsets[__po_hi_prs_mgmt_nb_ports];
__po_hi_port_id_t __po_hi_prs_mgmt_offsets[__po_hi_prs_mgmt_nb_ports];
__po_hi_port_id_t __po_hi_prs_mgmt_used_size[__po_hi_prs_mgmt_nb_ports];
__po_hi_port_id_t __po_hi_prs_mgmt_empties[__po_hi_prs_mgmt_nb_ports];
__po_hi_port_id_t __po_hi_prs_mgmt_first[__po_hi_prs_mgmt_nb_ports];
__po_hi_request_t *__po_hi_prs_mgmt_recent[__po_hi_prs_mgmt_nb_ports];
__po_hi_request_t *__po_hi_prs_mgmt_queue[0];
__po_hi_uint16_t __po_hi_prs_mgmt_total_fifo_size = 0;
__po_hi_local_port_t __po_hi_prs_mgmt_history[0];
__po_hi_port_id_t __po_hi_prs_mgmt_n_dest[__po_hi_prs_mgmt_nb_ports] = {0,1,1};
__po_hi_port_id_t __po_hi_prs_mgmt_fifo_size[__po_hi_prs_mgmt_nb_ports] = {__PO_HI_GQUEUE_FIFO_INDATA,__PO_HI_GQUEUE_FIFO_OUT,__PO_HI_GQUEUE_FIFO_OUT};
__po_hi_port_t* __po_hi_prs_mgmt_destinations[__po_hi_prs_mgmt_nb_ports] = {NULL,__po_hi_prs_mgmt_speed_local_destinations,__po_hi_prs_mgmt_angle_local_destinations};

/*!
 * \fn void prs_mgmt_deliver (__po_hi_request_t* request)
 * \brief Function that delivers requests to the task prs_mgmt
 *
 * When the generated application received a request, it calls a main delivery
 *  function that redirects to localfunctions for each task. This function 
 * (prs_mgmt_deliver) stores the incoming request for the taskprs_mgmt
 */
void prs_mgmt_deliver 
    (__po_hi_request_t* request)
{

  switch (request->port)
  {
    case prs_mgmt_global_gps_pos:
    {
      __po_hi_gqueue_store_in (process_ardupilot_prs_mgmt_k, prs_mgmt_local_gps_pos, request);

      break;
    }
    default:
    {
      break;
    }
  }
}


/*!
 * \fn void* prs_mgmt_job (void)
 * \brief Function executed by the task prs_mgmt
 *
 * This function is executed as soon as the task  is created. It performs the 
 * following operations:  Receive incoming data,  Execute tasks subprograms,  
 * Send output data.
 */
/*  Periodic task : prs_mgmt */
/*  Get the IN ports values */
void* prs_mgmt_job (void)
{
  __po_hi_request_t *gps_pos_request;
  static base_types__integer speed_request_var;
  static base_types__integer angle_request_var;
  __po_hi_request_t *speed_request;
  __po_hi_request_t *angle_request;
  __po_hi_int32_t error;

  
/*!
 * Waiting for other tasks initialization
 */
  __po_hi_wait_initialization ();
  __po_hi_compute_next_period (process_ardupilot_prs_mgmt_k);
  
/*!
 * Waiting for the first dispatch instant
 */
  __po_hi_wait_for_next_period (process_ardupilot_prs_mgmt_k);
  
/*!
 * Task body
 */
  while (1)
  {
    /* :: Yes if commentary :: */
    if (__po_hi_gqueue_get_count (process_ardupilot_prs_mgmt_k, prs_mgmt_local_gps_pos))
    {
          __po_hi_gqueue_get_value (process_ardupilot_prs_mgmt_k, prs_mgmt_local_gps_pos, &(gps_pos_request));
      __po_hi_gqueue_next_value (process_ardupilot_prs_mgmt_k, prs_mgmt_local_gps_pos);

    }
    /*  Call implementation */
    ardupilot_software__spg_flt_mgmt_simulation (gps_pos_request->vars.prs_mgmt_global_gps_pos.prs_mgmt_global_gps_pos, &(speed_request_var), &(angle_request_var));
    /*  Set the OUT port values */
    speed_request =
     __po_hi_get_request ();
    speed_request->vars.prs_mgmt_global_speed.prs_mgmt_global_speed = speed_request_var;
    speed_request->port = prs_mgmt_global_speed;
    __po_hi_gqueue_store_out (process_ardupilot_prs_mgmt_k, prs_mgmt_local_speed, speed_request);
    angle_request =
     __po_hi_get_request ();
    angle_request->vars.prs_mgmt_global_angle.prs_mgmt_global_angle = angle_request_var;
    angle_request->port = prs_mgmt_global_angle;
    __po_hi_gqueue_store_out (process_ardupilot_prs_mgmt_k, prs_mgmt_local_angle, angle_request);
    /*  Send the OUT ports */
    error =
     __po_hi_send_output (process_ardupilot_prs_mgmt_k, prs_mgmt_global_speed);
    (void)error;
    error =
     __po_hi_send_output (process_ardupilot_prs_mgmt_k, prs_mgmt_global_angle);
    (void)error;
    __po_hi_wait_for_next_period (process_ardupilot_prs_mgmt_k);
  }
}

__po_hi_port_id_t __po_hi_prs_throttle_woffsets[__po_hi_prs_throttle_nb_ports];
__po_hi_port_id_t __po_hi_prs_throttle_offsets[__po_hi_prs_throttle_nb_ports];
__po_hi_port_id_t __po_hi_prs_throttle_used_size[__po_hi_prs_throttle_nb_ports];
__po_hi_port_id_t __po_hi_prs_throttle_empties[__po_hi_prs_throttle_nb_ports];
__po_hi_port_id_t __po_hi_prs_throttle_first[__po_hi_prs_throttle_nb_ports];
__po_hi_request_t *__po_hi_prs_throttle_recent[__po_hi_prs_throttle_nb_ports];
__po_hi_request_t *__po_hi_prs_throttle_queue[0];
__po_hi_uint16_t __po_hi_prs_throttle_total_fifo_size = 0;
__po_hi_local_port_t __po_hi_prs_throttle_history[0];
__po_hi_port_id_t __po_hi_prs_throttle_n_dest[__po_hi_prs_throttle_nb_ports] = {0};
__po_hi_port_id_t __po_hi_prs_throttle_fifo_size[__po_hi_prs_throttle_nb_ports] = {__PO_HI_GQUEUE_FIFO_INDATA};
__po_hi_port_t* __po_hi_prs_throttle_destinations[__po_hi_prs_throttle_nb_ports] = {NULL};

/*!
 * \fn void prs_throttle_deliver (__po_hi_request_t* request)
 * \brief Function that delivers requests to the task prs_throttle
 *
 * When the generated application received a request, it calls a main delivery
 *  function that redirects to localfunctions for each task. This function 
 * (prs_throttle_deliver) stores the incoming request for the taskprs_throttle
 */
void prs_throttle_deliver 
    (__po_hi_request_t* request)
{

  switch (request->port)
  {
    case prs_throttle_global_speed:
    {
      __po_hi_gqueue_store_in (process_ardupilot_prs_throttle_k, prs_throttle_local_speed, request);

      break;
    }
    default:
    {
      break;
    }
  }
}


/*!
 * \fn void* prs_throttle_job (void)
 * \brief Function executed by the task prs_throttle
 *
 * This function is executed as soon as the task  is created. It performs the 
 * following operations:  Receive incoming data,  Execute tasks subprograms,  
 * Send output data.
 */
/*  Periodic task : prs_throttle */
/*  Get the IN ports values */
void* prs_throttle_job (void)
{
  __po_hi_request_t *speed_request;

  
/*!
 * Waiting for other tasks initialization
 */
  __po_hi_wait_initialization ();
  __po_hi_compute_next_period (process_ardupilot_prs_throttle_k);
  
/*!
 * Waiting for the first dispatch instant
 */
  __po_hi_wait_for_next_period (process_ardupilot_prs_throttle_k);
  
/*!
 * Task body
 */
  while (1)
  {
    /* :: Yes if commentary :: */
    if (__po_hi_gqueue_get_count (process_ardupilot_prs_throttle_k, prs_throttle_local_speed))
    {
          __po_hi_gqueue_get_value (process_ardupilot_prs_throttle_k, prs_throttle_local_speed, &(speed_request));
      __po_hi_gqueue_next_value (process_ardupilot_prs_throttle_k, prs_throttle_local_speed);

    }
    /*  Call implementation */
    ardupilot_software__spg_throttle_simulation (speed_request->vars.prs_throttle_global_speed.prs_throttle_global_speed);
    __po_hi_wait_for_next_period (process_ardupilot_prs_throttle_k);
  }
}

__po_hi_port_id_t __po_hi_prs_yaw_woffsets[__po_hi_prs_yaw_nb_ports];
__po_hi_port_id_t __po_hi_prs_yaw_offsets[__po_hi_prs_yaw_nb_ports];
__po_hi_port_id_t __po_hi_prs_yaw_used_size[__po_hi_prs_yaw_nb_ports];
__po_hi_port_id_t __po_hi_prs_yaw_empties[__po_hi_prs_yaw_nb_ports];
__po_hi_port_id_t __po_hi_prs_yaw_first[__po_hi_prs_yaw_nb_ports];
__po_hi_request_t *__po_hi_prs_yaw_recent[__po_hi_prs_yaw_nb_ports];
__po_hi_request_t *__po_hi_prs_yaw_queue[0];
__po_hi_uint16_t __po_hi_prs_yaw_total_fifo_size = 0;
__po_hi_local_port_t __po_hi_prs_yaw_history[0];
__po_hi_port_id_t __po_hi_prs_yaw_n_dest[__po_hi_prs_yaw_nb_ports] = {0};
__po_hi_port_id_t __po_hi_prs_yaw_fifo_size[__po_hi_prs_yaw_nb_ports] = {__PO_HI_GQUEUE_FIFO_INDATA};
__po_hi_port_t* __po_hi_prs_yaw_destinations[__po_hi_prs_yaw_nb_ports] = {NULL};

/*!
 * \fn void prs_yaw_deliver (__po_hi_request_t* request)
 * \brief Function that delivers requests to the task prs_yaw
 *
 * When the generated application received a request, it calls a main delivery
 *  function that redirects to localfunctions for each task. This function 
 * (prs_yaw_deliver) stores the incoming request for the taskprs_yaw
 */
void prs_yaw_deliver 
    (__po_hi_request_t* request)
{

  switch (request->port)
  {
    case prs_yaw_global_angle:
    {
      __po_hi_gqueue_store_in (process_ardupilot_prs_yaw_k, prs_yaw_local_angle, request);

      break;
    }
    default:
    {
      break;
    }
  }
}


/*!
 * \fn void* prs_yaw_job (void)
 * \brief Function executed by the task prs_yaw
 *
 * This function is executed as soon as the task  is created. It performs the 
 * following operations:  Receive incoming data,  Execute tasks subprograms,  
 * Send output data.
 */
/*  Periodic task : prs_yaw */
/*  Get the IN ports values */
void* prs_yaw_job (void)
{
  __po_hi_request_t *angle_request;

  
/*!
 * Waiting for other tasks initialization
 */
  __po_hi_wait_initialization ();
  __po_hi_compute_next_period (process_ardupilot_prs_yaw_k);
  
/*!
 * Waiting for the first dispatch instant
 */
  __po_hi_wait_for_next_period (process_ardupilot_prs_yaw_k);
  
/*!
 * Task body
 */
  while (1)
  {
    /* :: Yes if commentary :: */
    if (__po_hi_gqueue_get_count (process_ardupilot_prs_yaw_k, prs_yaw_local_angle))
    {
          __po_hi_gqueue_get_value (process_ardupilot_prs_yaw_k, prs_yaw_local_angle, &(angle_request));
      __po_hi_gqueue_next_value (process_ardupilot_prs_yaw_k, prs_yaw_local_angle);

    }
    /*  Call implementation */
    ardupilot_software__spg_yaw_simulation (angle_request->vars.prs_yaw_global_angle.prs_yaw_global_angle);
    __po_hi_wait_for_next_period (process_ardupilot_prs_yaw_k);
  }
}


/*!
 * \fn void __po_hi_main_deliver (__po_hi_request_t* request)
 * \brief Used to deliver request to the appropriate ports
 *
 * This function takes a request as argument (\arg request) and calls the 
 * appropriate function for its delivery.To specify which function should be 
 * called, it extracts the receiver entity using the destination port.
 */
void __po_hi_main_deliver 
    (__po_hi_request_t* request)
{
  __po_hi_entity_t entity;

  entity = __po_hi_get_entity_from_global_port (request->port);
  switch (entity)
  {
    case process_ardupilot_prs_mgmt_k_entity:
    {
      prs_mgmt_deliver (request);

      break;
    }
    case process_ardupilot_prs_throttle_k_entity:
    {
      prs_throttle_deliver (request);

      break;
    }
    case process_ardupilot_prs_yaw_k_entity:
    {
      prs_yaw_deliver (request);

      break;
    }
    default:
    {
      break;
    }
  }
}

void __po_hi_main_initialize (void)
{

  __po_hi_gqueue_init (process_ardupilot_prs_gps_k, __po_hi_prs_gps_nb_ports, __po_hi_prs_gps_queue, __po_hi_prs_gps_fifo_size, __po_hi_prs_gps_first, __po_hi_prs_gps_offsets, __po_hi_prs_gps_woffsets, __po_hi_prs_gps_n_dest, __po_hi_prs_gps_destinations, __po_hi_prs_gps_used_size, __po_hi_prs_gps_history, __po_hi_prs_gps_recent, __po_hi_prs_gps_empties, __po_hi_prs_gps_total_fifo_size);
  __po_hi_gqueue_init (process_ardupilot_prs_mgmt_k, __po_hi_prs_mgmt_nb_ports, __po_hi_prs_mgmt_queue, __po_hi_prs_mgmt_fifo_size, __po_hi_prs_mgmt_first, __po_hi_prs_mgmt_offsets, __po_hi_prs_mgmt_woffsets, __po_hi_prs_mgmt_n_dest, __po_hi_prs_mgmt_destinations, __po_hi_prs_mgmt_used_size, __po_hi_prs_mgmt_history, __po_hi_prs_mgmt_recent, __po_hi_prs_mgmt_empties, __po_hi_prs_mgmt_total_fifo_size);
  __po_hi_gqueue_init (process_ardupilot_prs_throttle_k, __po_hi_prs_throttle_nb_ports, __po_hi_prs_throttle_queue, __po_hi_prs_throttle_fifo_size, __po_hi_prs_throttle_first, __po_hi_prs_throttle_offsets, __po_hi_prs_throttle_woffsets, __po_hi_prs_throttle_n_dest, __po_hi_prs_throttle_destinations, __po_hi_prs_throttle_used_size, __po_hi_prs_throttle_history, __po_hi_prs_throttle_recent, __po_hi_prs_throttle_empties, __po_hi_prs_throttle_total_fifo_size);
  __po_hi_gqueue_init (process_ardupilot_prs_yaw_k, __po_hi_prs_yaw_nb_ports, __po_hi_prs_yaw_queue, __po_hi_prs_yaw_fifo_size, __po_hi_prs_yaw_first, __po_hi_prs_yaw_offsets, __po_hi_prs_yaw_woffsets, __po_hi_prs_yaw_n_dest, __po_hi_prs_yaw_destinations, __po_hi_prs_yaw_used_size, __po_hi_prs_yaw_history, __po_hi_prs_yaw_recent, __po_hi_prs_yaw_empties, __po_hi_prs_yaw_total_fifo_size);
}


